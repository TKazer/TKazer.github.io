<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>WMCTF2025 VideoPlayer 逆向出题笔记 | Liv's blog</title><meta name="author" content="Liv"><meta name="copyright" content="Liv"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="WMCTF2025 逆向出题笔记这次我出的题预期难度定在了Hard，最后结束在三解，符合预期。这次的项目代码量很大，费了不少时间去构思，就是为了出不恶心人的难题，是合理的难，而且还不失乐趣。   [出题构思]这次出题我是往现实场景逆向靠拢，也就是模仿的现实逆向商业VMP保护下的软件场景，想要考察的是选手的软件综合审计能力，以及动态调试、观察数据能力。所以弱化了（甚至没有）传统的加解密环节。仅仅需要">
<meta property="og:type" content="article">
<meta property="og:title" content="WMCTF2025 VideoPlayer 逆向出题笔记">
<meta property="og:url" content="https://tkazer.github.io/2025/09/20/WMCTF2025-DevNote/index.html">
<meta property="og:site_name" content="Liv&#39;s blog">
<meta property="og:description" content="WMCTF2025 逆向出题笔记这次我出的题预期难度定在了Hard，最后结束在三解，符合预期。这次的项目代码量很大，费了不少时间去构思，就是为了出不恶心人的难题，是合理的难，而且还不失乐趣。   [出题构思]这次出题我是往现实场景逆向靠拢，也就是模仿的现实逆向商业VMP保护下的软件场景，想要考察的是选手的软件综合审计能力，以及动态调试、观察数据能力。所以弱化了（甚至没有）传统的加解密环节。仅仅需要">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tkazer.github.io/img/butterfly-icon.png">
<meta property="article:published_time" content="2025-09-20T08:11:34.000Z">
<meta property="article:modified_time" content="2025-09-22T12:20:45.638Z">
<meta property="article:author" content="Liv">
<meta property="article:tag" content="CTF出题">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tkazer.github.io/img/butterfly-icon.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "WMCTF2025 VideoPlayer 逆向出题笔记",
  "url": "https://tkazer.github.io/2025/09/20/WMCTF2025-DevNote/",
  "image": "https://tkazer.github.io/img/butterfly-icon.png",
  "datePublished": "2025-09-20T08:11:34.000Z",
  "dateModified": "2025-09-22T12:20:45.638Z",
  "author": [
    {
      "@type": "Person",
      "name": "Liv",
      "url": "https://tkazer.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://tkazer.github.io/2025/09/20/WMCTF2025-DevNote/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'WMCTF2025 VideoPlayer 逆向出题笔记',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Liv's blog" type="application/atom+xml">
</head><body><div id="web_bg" style="background-image: url(https://i.postimg.cc/Y2VMBKkT/windows-11-landscape-scenery-sunrise-stock-day-light-3840x2400-5667.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="https://i.postimg.cc/C5dMXV2c/pic.png" alt="Logo"><span class="site-name">Liv's blog</span></a><a class="nav-page-title" href="/"><span class="site-name">WMCTF2025 VideoPlayer 逆向出题笔记</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">WMCTF2025 VideoPlayer 逆向出题笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-09-20T08:11:34.000Z" title="发表于 2025-09-20 16:11:34">2025-09-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-09-22T12:20:45.638Z" title="更新于 2025-09-22 20:20:45">2025-09-22</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="container post-content" id="article-container"><h1 id="WMCTF2025-逆向出题笔记"><a href="#WMCTF2025-逆向出题笔记" class="headerlink" title="WMCTF2025 逆向出题笔记"></a>WMCTF2025 逆向出题笔记</h1><p>这次我出的题预期难度定在了Hard，最后结束在三解，符合预期。这次的项目代码量很大，费了不少时间去构思，就是为了出不恶心人的难题，是合理的难，而且还不失乐趣。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image100.png" alt="alt text"></p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image.png" alt="alt text"></p>
<h2 id="出题构思"><a href="#出题构思" class="headerlink" title="[出题构思]"></a>[出题构思]</h2><p>这次出题我是往现实场景逆向靠拢，也就是模仿的现实逆向商业VMP保护下的软件场景，想要考察的是选手的软件综合审计能力，以及动态调试、观察数据能力。所以弱化了（甚至没有）传统的加解密环节。仅仅需要静态分析配合动态调试即可得到Flag，但是需要很强的代码审计能力。</p>
<p>UI的框架选用Imgui，因为我平常开发UI都是用这个，所以用的比较顺手，（推荐一波我开源的OS-ImGui库-&gt;<a target="_blank" rel="noopener" href="https://github.com/TKazer/OS-ImGui">OS-ImGui</a>，基于ImGui的二次封装库）。由于ImGui库的代码量较大，所以最终VMP保护后代码膨胀较大，造成脱壳后IDA加载分析较为吃力，后续上传了体积更小的版本便于IDA进行静态分析。</p>
<p>加上VMP是因为仿制现实逆向场景，而且我需要其中的函数保护功能，对其中三个核心函数进行虚拟化保护，考验选手从其他函数进行侧面逆向来综合分析，也就是在函数不完整的情况下去探索软件的流程，通过分析函数调用流，去寻找漏洞点。</p>
<h2 id="题目设计"><a href="#题目设计" class="headerlink" title="[题目设计]"></a>[题目设计]</h2><p>这题背景选在了加密视频播放器下，因为平常买的一些课程视频大多都用一些视频保护器进行保护，需要特定的加密视频播放器登入才能播放视频，所以就选了这么一个场景来当作题目背景。</p>
<h3 id="主流程"><a href="#主流程" class="headerlink" title="[主流程]"></a>[主流程]</h3><ol>
<li>需要账号密码来登入软件，然后不同账号播放加密视频的密钥是不一样的，是根据该账号绑定的机器信息生成的，也就是一机一密。</li>
</ol>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-4.png" alt="alt text"></p>
<ol start="2">
<li>预留了后门超级用户，且该超级用户只校验输入的用户名，不校验密码，这边特意使用<code>strcmp</code>校验超级用户名，方便选手拦截到超级用户名。</li>
</ol>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-1.png" alt="alt text"></p>
<ol start="3">
<li>模仿游戏反作弊机器码部分功能，获取目前机器的一些信息，如：硬盘序列号、Mac地址等机器信息，然后整合进行MD5，进行本地校验是否为超级用户的机器，校验通过则登入成功，并且该超级用户机器信息MD5直接作为密钥凭证进行使用。</li>
</ol>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-2.png" alt="alt text"></p>
<ol start="4">
<li>选取<code>.mp0</code>后缀加密视频文件进行播放，但软件不具备视频播放能力，但是在软件中已经解密了，直接找到解密处断点步过执行提取解密后数据即可。</li>
</ol>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-3.png" alt="alt text"></p>
<h2 id="题目writeup-："><a href="#题目writeup-：" class="headerlink" title="[题目writeup]："></a>[题目writeup]：</h2><h3 id="反调试处理-VMP脱壳Dump"><a href="#反调试处理-VMP脱壳Dump" class="headerlink" title="反调试处理+VMP脱壳Dump"></a>反调试处理+VMP脱壳Dump</h3><h4 id="法1：TitanHide过反调试"><a href="#法1：TitanHide过反调试" class="headerlink" title="法1：TitanHide过反调试"></a>法1：TitanHide过反调试</h4><p>这边反调试使用TitanHide驱动，Github可以搜索到相关项目，运行TitanHide.sys需要配置环境。</p>
<p>使用VKD工具的target64中的vminstall在虚拟机中运行安装，会多出来一个引导启动，重启电脑选择新的引导启动就可以，他会进入内核调试模式，禁止驱动强制签名以及关闭PG，也就可以让我们加载titanhide驱动。</p>
<p>运行titanhide.sys，将titanhide的dbg相关插件文件放入dbg的plugins文件夹中，运行dbg即可调试VMP程序。</p>
<h4 id="法2：CheatEngine-Veh-debugger"><a href="#法2：CheatEngine-Veh-debugger" class="headerlink" title="法2：CheatEngine Veh debugger"></a>法2：CheatEngine Veh debugger</h4><p>软件运行后，使用CE附加，选用VEH Debugger即可进行断点调试。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image101.png" alt="alt text"></p>
<h4 id="寻找OEP"><a href="#寻找OEP" class="headerlink" title="寻找OEP"></a>寻找OEP</h4><p>断点<code>GetSystemTimeAsFileTime</code>，运行，第二次断下后，栈的第二个返回地址就是OEP，这也是exe程序VMP寻找OEP的通法。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-35.png" alt="alt text"></p>
<p>OEP:</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-36.png" alt="alt text"></p>
<p>RIP修改到OEP，使用Scylla插件Dump程序。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-37.png" alt="alt text"></p>
<h3 id="主流程分析"><a href="#主流程分析" class="headerlink" title="主流程分析"></a>主流程分析</h3><p>IDA加载Dump的程序，可以通过字符串定位到Login页面代码，但是会发现Login按钮后调用的相关登入Check函数，被VMP虚拟保护了，所以无法正向从这边分析。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-65.png" alt="alt text"></p>
<p>题目说存在后门账户，猜测会通过strcmp判断用户名或密码文本（这边通过断点用户名或密码的内存进行后续分析也可以）</p>
<p>随便输入用户名和密码后，断点strcmp，点击Login按钮断下，发现会判断一次用户名是否为<code>WMAdmin_#6&amp;JZZ%B</code>，证实确实存在后门用户名判断，但是目前还是登入失败。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-64.png" alt="alt text"></p>
<p>字符串这边可以看到一些系统信息相关字符串。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-66.png" alt="alt text"></p>
<p>定位到字符串相关调用函数，再查函数的交叉调用，发现这边会调用多个引用到系统字符串相关函数。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-69.png" alt="alt text"></p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-67.png" alt="alt text"></p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-68.png" alt="alt text"></p>
<p>dbg定位到调用这些函数的主函数，断点，发现正常输入随机用户名和密码并不会触发，用户名输入后门用户名时会触发。</p>
<p>这个获取系统信息的函数会断下，执行到ret，发现是获取了多个系统信息字串，然后拼接到一起返回。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-70.png" alt="alt text"></p>
<p>单步返回到这边，分析这部分代码，发现是将获取到的系统信息字串进行MD5，然后逐字节push_back到一个vector容器中。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-71.png" alt="alt text"></p>
<p>执行到push_back之后的Call，让所有数据添加完毕，push_back的第一个参数rcx就是容器对象本身，也就是<code>[rsp+80]</code>，对<code>[rsp+80]</code>下8字节的硬件断点，运行，会断到下面这个函数。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-72.png" alt="alt text"></p>
<p>单步运行到返回，来到如下函数，复制部分二进制<code>48 63 44 24 24 48 89 44 24 50 48 8B 8C 24 D0 00 00 00 E8 E9 92 FF FF</code>，到IDA搜索字节找到对应函数进行反编译分析。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-73.png" alt="alt text"></p>
<p>可以发现这边是将刚刚系统信息MD5的Vector数据传入进来然后逐个与v5数组比对，如果相等则返回1，不等则返回0。</p>
<p>结合题目信息，可以知道该软件登入后门用户的时候还会对机器进行校验，如果是指定机器才会登入成功。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-74.png" alt="alt text"></p>
<p>尝试运行到ret，将函数返回值rax修改成1。<br><img src="/2025/09/20/WMCTF2025-DevNote/image-75.png" alt="alt text"></p>
<p>结果动调发现上面MD5数组在后续仍被访问，最后会到这边，v34就是上面的那个数组对象，第一个箭头函数是判断数组是否为空，如果为空则报错账号密码错误，如果不为空则把数据复制给a1参数的Vector数组。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-76.png" alt="alt text"></p>
<p>Vector判断是否数据为空：</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-77.png" alt="alt text"></p>
<p>这边就可以该程序登入的大概流程：</p>
<ol>
<li><p>输入账号、密码</p>
</li>
<li><p>判断是否为后门账户名</p>
</li>
<li><p>获取机器信息MD5，储存到Vector数组</p>
</li>
<li><p>返回Vector数组，如果账号密码错误则Vector数组为空，如果后门账号登入失败也同样为空。</p>
</li>
<li><p>将返回的MD5信息数组数据复制到登入函数的参数Vector容器中。</p>
</li>
</ol>
<p>上面操作流程中我们将检验机器的那个函数返回值改成了1，也就是true，让他通过后门登入，所以返回了MD5数据数组。</p>
<p>IDA字符串可以找到”Open File”和”Play Video”相关字串，跳转到调用函数，就可以看到这个是登入后的页面相关函数。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-78.png" alt="alt text"></p>
<p>“Open File”下面那个Call就是初始化结构，打开对话框的。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-79.png" alt="alt text"></p>
<p>通过调试该页面函数，发现第一个箭头就是将对话框里面选中的文件目录绘制到窗口上，上面的(255,255,255,255)就是字体颜色，第二个箭头处判断选中文件目录是否为空，如果不为空则返回1，为空则弹对话框要求选中一个.mp0后缀的文件并返回0。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-80.png" alt="alt text"></p>
<p>通过相关字符串查交叉引用定位到Player Page页面，这边也能看到打开视频文件的错误信息，复制函数部分代码字节<code>48 89 54 24 10 48 89 4C 24 08 56 57 48 81 EC B8 01 00 00 B8 04 00 00 00</code>，到dbg搜索，对函数头下硬件断点。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-81.png" alt="alt text"></p>
<p>选择video.mp0文件，然后点击Play按钮断下，发现该函数的参数一rcx是上面返回的MD5 Vector数据对象，进入两层就可以看到之前得到的MD5数据。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-82.png" alt="alt text"></p>
<p>IDA这边可以看到判断是否通过a2文件路径的读入文件成功，然后传入文件数据以及a1参数（MD5数据）调用了一个函数，动调可以发现这边第三个参数就是返回的数据，那么这边就可以猜测就是视频数据解密函数。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-83.png" alt="alt text"></p>
<p>通过题目可以知道该视频播放器并没有开发完成，在下面也看不到对该返回数据操作的相关代码，以及播放视频相关代码，所以就只能断在上面函数调用，单步执行，然后拿到第三个参数的数据，手动导出到文件。</p>
<p>题目可知该视频是由后门账户加密的，且解密的时候有传入系统信息MD5数据，所以要在MD5函数调用处将数据修改成上面校验的目标数据，也就是后门账号电脑系统信息MD5数据。</p>
<p>这样后续解密的时候就会传入后门账号电脑系统信息MD5数据，成功解密由后门账号加密的视频。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-84.png" alt="alt text"></p>
<p>断在该处记下参数三r8的地址，单步执行后，跳转到r8地址，将md5数据修改成<code>B4 EC ED FE 29 6E DE 7B 93 84 57 AF 61 9C 83 4B</code>。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-85.png" alt="alt text"></p>
<p>复制IDA中的调用解密函数的汇编字节<code>4C 8D 05 C1 9D 02 00 48 8B 94 24 D0 01 00 00 48 8D 0D 92 9D 02 00 E8 7D 35 F9 FF</code>，dbg搜索定位到解密函数调用，断下。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-86.png" alt="alt text"></p>
<p>选择video.mp0文件，点击Play按钮断下，记下参数三r8地址，单步执行Call，然后等待解密完成，跳转到r8地址。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-87.png" alt="alt text"></p>
<p>可以看到r8这边还是一个Vector结构，第一个是数据头指针，第二个是数据尾指针，相减就是数据大小，这边计算得到为<code>11904</code>字节大小。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-88.png" alt="alt text"></p>
<p>进入第一个地址，就可以看到成功解密出来的相关mp4文件数据。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-89.png" alt="alt text"></p>
<p>使用Scylla插件，File-&gt;Dump memory，填入数据头指针地址，以及数据大小，进行Dump。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-90.png" alt="alt text"></p>
<p>Dump得到mp4文件，打开就可以看到输入Flag的视频，拉到最后就是完整Flag。</p>
<p><img src="/2025/09/20/WMCTF2025-DevNote/image-91.png" alt="alt text"></p>
<h3 id="Flag"><a href="#Flag" class="headerlink" title="[Flag]"></a>[Flag]</h3><p><code>WMCTF&#123;63840490-84c5-4223-b5ee-63d4e51d0f05&#125;</code></p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTF%E5%87%BA%E9%A2%98/">CTF出题</a></div><div class="post-share"><div class="social-share" data-image="/img/butterfly-icon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/08/20/KCTF2025/" title="KCTF2025"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">KCTF2025</div></div><div class="info-2"><div class="info-item-1">第四题...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/03/06/GHCTF2025WP/" title="GHCTF2025WP"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-06</div><div class="info-item-2">GHCTF2025WP</div></div><div class="info-2"><div class="info-item-1">GHCTF 2025 Reverse WP这次也是第一次给CTF比赛出题，经验不足，完全是凭借之前打比赛做的题的经验来出的，难度尽可能把控住梯度上升，但是可能还是没做的那么好，各位师傅见谅了，如果有什么建议也可以联系我。 ASN?Signin!分析这题估计大伙都AI一把梭了（），不过还是讲讲asm代码分析流程。 asm代码开头是数据段，存放着DATA1和DATA2，这两段就是关键数据。 1234567891011121314151617181920.DATA    WELCOME_MSG db &#x27;Welcome to GHCTF!&#x27;, 0DH, 0AH, &#x27;$&#x27;    INPUT_MSG db &#x27;Input your flag:&#x27;, &#x27;$&#x27;    WRONG_MSG db 0DH, 0AH, &#x27;Wrong!&#x27;, 0DH, 0AH, &#x27;$&#x27;    RIGHT_MSG db 0DH, 0AH, &#x27;Right!&#x27;, 0DH, 0AH,...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Liv</div><div class="author-info-description">欢迎来到Liv的博客。</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/TKazer"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/TKazer" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#WMCTF2025-%E9%80%86%E5%90%91%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0"><span class="toc-number">1.</span> <span class="toc-text">WMCTF2025 逆向出题笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BA%E9%A2%98%E6%9E%84%E6%80%9D"><span class="toc-number">1.1.</span> <span class="toc-text">[出题构思]</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.2.</span> <span class="toc-text">[题目设计]</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E6%B5%81%E7%A8%8B"><span class="toc-number">1.2.1.</span> <span class="toc-text">[主流程]</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AEwriteup-%EF%BC%9A"><span class="toc-number">1.3.</span> <span class="toc-text">[题目writeup]：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E8%B0%83%E8%AF%95%E5%A4%84%E7%90%86-VMP%E8%84%B1%E5%A3%B3Dump"><span class="toc-number">1.3.1.</span> <span class="toc-text">反调试处理+VMP脱壳Dump</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%951%EF%BC%9ATitanHide%E8%BF%87%E5%8F%8D%E8%B0%83%E8%AF%95"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">法1：TitanHide过反调试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%952%EF%BC%9ACheatEngine-Veh-debugger"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">法2：CheatEngine Veh debugger</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%BB%E6%89%BEOEP"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">寻找OEP</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90"><span class="toc-number">1.3.2.</span> <span class="toc-text">主流程分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flag"><span class="toc-number">1.3.3.</span> <span class="toc-text">[Flag]</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/20/WMCTF2025-DevNote/" title="WMCTF2025 VideoPlayer 逆向出题笔记">WMCTF2025 VideoPlayer 逆向出题笔记</a><time datetime="2025-09-20T08:11:34.000Z" title="发表于 2025-09-20 16:11:34">2025-09-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/20/KCTF2025/" title="KCTF2025">KCTF2025</a><time datetime="2025-08-20T08:20:46.000Z" title="发表于 2025-08-20 16:20:46">2025-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/19/SekaiCTF2025/" title="SekaiCTF 2025 Reverse WP">SekaiCTF 2025 Reverse WP</a><time datetime="2025-08-19T13:45:38.000Z" title="发表于 2025-08-19 21:45:38">2025-08-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/31/NepCTF2025-XSafe/" title="NepCTF2025 XSafe WP">NepCTF2025 XSafe WP</a><time datetime="2025-07-31T12:28:40.000Z" title="发表于 2025-07-31 20:28:40">2025-07-31</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/28/NepCTF2025/" title="NepCTF2025 WP">NepCTF2025 WP</a><time datetime="2025-07-27T16:40:42.000Z" title="发表于 2025-07-28 00:40:42">2025-07-28</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://i.postimg.cc/Y2VMBKkT/windows-11-landscape-scenery-sunrise-stock-day-light-3840x2400-5667.jpg);"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By Liv</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>