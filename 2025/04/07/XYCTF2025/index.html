<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>XYCTF2025 | Liv's blog</title><meta name="author" content="Liv"><meta name="copyright" content="Liv"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="XYCTF2025 逆向WP虽然这次失去Web手，但是配合新来的师傅，小队的队员们也一起努力打了不错的成绩。 墨水师傅的MDriver题也是拼尽全力无法战胜（，总体逆向题的质量挺不错的，没什么烂活，值得一试。 WARMUP网上抄的VBS解密代码 12345678910111213141516171819202122232425262728Function Defuscator(vbs)    Di">
<meta property="og:type" content="article">
<meta property="og:title" content="XYCTF2025">
<meta property="og:url" content="https://tkazer.github.io/2025/04/07/XYCTF2025/index.html">
<meta property="og:site_name" content="Liv&#39;s blog">
<meta property="og:description" content="XYCTF2025 逆向WP虽然这次失去Web手，但是配合新来的师傅，小队的队员们也一起努力打了不错的成绩。 墨水师傅的MDriver题也是拼尽全力无法战胜（，总体逆向题的质量挺不错的，没什么烂活，值得一试。 WARMUP网上抄的VBS解密代码 12345678910111213141516171819202122232425262728Function Defuscator(vbs)    Di">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tkazer.github.io/img/butterfly-icon.png">
<meta property="article:published_time" content="2025-04-07T10:30:03.000Z">
<meta property="article:modified_time" content="2025-04-22T10:39:58.695Z">
<meta property="article:author" content="Liv">
<meta property="article:tag" content="CTF比赛">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tkazer.github.io/img/butterfly-icon.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "XYCTF2025",
  "url": "https://tkazer.github.io/2025/04/07/XYCTF2025/",
  "image": "https://tkazer.github.io/img/butterfly-icon.png",
  "datePublished": "2025-04-07T10:30:03.000Z",
  "dateModified": "2025-04-22T10:39:58.695Z",
  "author": [
    {
      "@type": "Person",
      "name": "Liv",
      "url": "https://tkazer.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://tkazer.github.io/2025/04/07/XYCTF2025/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'XYCTF2025',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Liv's blog" type="application/atom+xml">
</head><body><div id="web_bg" style="background-image: url(https://i.postimg.cc/Y2VMBKkT/windows-11-landscape-scenery-sunrise-stock-day-light-3840x2400-5667.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="https://i.postimg.cc/C5dMXV2c/pic.png" alt="Logo"><span class="site-name">Liv's blog</span></a><a class="nav-page-title" href="/"><span class="site-name">XYCTF2025</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 目录</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">XYCTF2025</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-04-07T10:30:03.000Z" title="发表于 2025-04-07 18:30:03">2025-04-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-04-22T10:39:58.695Z" title="更新于 2025-04-22 18:39:58">2025-04-22</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="container post-content" id="article-container"><h1 id="XYCTF2025-逆向WP"><a href="#XYCTF2025-逆向WP" class="headerlink" title="XYCTF2025 逆向WP"></a>XYCTF2025 逆向WP</h1><p>虽然这次失去Web手，但是配合新来的师傅，小队的队员们也一起努力打了不错的成绩。</p>
<p>墨水师傅的MDriver题也是拼尽全力无法战胜（，总体逆向题的质量挺不错的，没什么烂活，值得一试。</p>
<h2 id="WARMUP"><a href="#WARMUP" class="headerlink" title="WARMUP"></a>WARMUP</h2><p>网上抄的VBS解密代码</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Function</span> Defuscator(vbs)</span><br><span class="line">    <span class="keyword">Dim</span> t</span><br><span class="line">    t = InStr(<span class="number">1</span>, vbs, <span class="string">&quot;Execute&quot;</span>, <span class="number">1</span>)</span><br><span class="line">    t = <span class="keyword">Mid</span>(vbs, t + Len(<span class="string">&quot;Execute&quot;</span>))</span><br><span class="line">    t = Eval(t)</span><br><span class="line">    Defuscator = t</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Dim</span> fso, i, outFile</span><br><span class="line"><span class="keyword">Const</span> ForReading = <span class="number">1</span>, ForWriting = <span class="number">2</span></span><br><span class="line"><span class="keyword">Set</span> fso = CreateObject(<span class="string">&quot;Scripting.FileSystemObject&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">&#x27; 创建或打开一个文件用于写入输出</span></span><br><span class="line">    <span class="keyword">Set</span> outFile = fso.OpenTextFile(<span class="string">&quot;output.txt&quot;</span>, ForWriting, <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">For</span> i = <span class="number">0</span> <span class="keyword">To</span> WScript.Arguments.Count - <span class="number">1</span></span><br><span class="line">        <span class="keyword">Dim</span> FileName</span><br><span class="line">        FileName = WScript.Arguments(i)</span><br><span class="line">        <span class="keyword">Dim</span> MyFile</span><br><span class="line">        <span class="keyword">Set</span> MyFile = fso.OpenTextFile(FileName, ForReading)</span><br><span class="line">            <span class="keyword">Dim</span> vbs</span><br><span class="line">            vbs = MyFile.ReadAll</span><br><span class="line">            outFile.WriteLine Defuscator(vbs)</span><br><span class="line">            MyFile.Close</span><br><span class="line">        <span class="keyword">Next</span></span><br><span class="line"></span><br><span class="line">        outFile.Close</span><br><span class="line">        <span class="keyword">Set</span> fso = <span class="literal">Nothing</span></span><br></pre></td></tr></table></figure>

<p>output.txt:</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">MsgBox <span class="string">&quot;Dear CTFER. Have fun in XYCTF 2025!&quot;</span></span><br><span class="line">flag = InputBox(<span class="string">&quot;Enter the FLAG:&quot;</span>, <span class="string">&quot;XYCTF&quot;</span>)</span><br><span class="line">wefbuwiue = <span class="string">&quot;90df4407ee093d309098d85a42be57a2979f1e51463a31e8d15e2fac4e84ea0df622a55c4ddfb535ef3e51e8b2528b826d5347e165912e99118333151273cc3fa8b2b3b413cf2bdb1e8c9c52865efc095a8dd89b3b3cfbb200bbadbf4a6cd4&quot;</span> <span class="comment">&#x27; 棰勮鐨凴C4鍔犲瘑缁撴灉锛堝崄鍏繘鍒舵牸寮忥級</span></span><br><span class="line">qwfe = <span class="string">&quot;rc4key&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&#x27; 淇鍚庣殑RC4鍔犲瘑鍑芥暟</span></span><br><span class="line"><span class="keyword">Function</span> RunRC(sMessage, strKey)</span><br><span class="line">    <span class="keyword">Dim</span> kLen, i, j, temp, pos, outHex</span><br><span class="line">    <span class="keyword">Dim</span> s(<span class="number">255</span>), k(<span class="number">255</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27; 鍒濆鍖栧瘑閽?</span></span><br><span class="line">    kLen = Len(strKey)</span><br><span class="line">    <span class="keyword">For</span> i = <span class="number">0</span> <span class="keyword">To</span> <span class="number">255</span></span><br><span class="line">        s(i) = i</span><br><span class="line">        k(i) = Asc(<span class="keyword">Mid</span>(strKey, (i <span class="built_in">Mod</span> kLen) + <span class="number">1</span>, <span class="number">1</span>)) <span class="comment">&#x27; 瀵嗛挜浣跨敤ASCII缂栫爜</span></span><br><span class="line">    <span class="keyword">Next</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27; KSA瀵嗛挜璋冨害</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">For</span> i = <span class="number">0</span> <span class="keyword">To</span> <span class="number">255</span></span><br><span class="line">        j = (j + s(i) + k(i)) <span class="built_in">Mod</span> <span class="number">256</span></span><br><span class="line">        temp = s(i)</span><br><span class="line">        s(i) = s(j)</span><br><span class="line">        s(j) = temp</span><br><span class="line">    <span class="keyword">Next</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27; PRGA鍔犲瘑娴佺▼</span></span><br><span class="line">    i = <span class="number">0</span> : j = <span class="number">0</span> : outHex = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">For</span> pos = <span class="number">1</span> <span class="keyword">To</span> Len(sMessage)</span><br><span class="line">        i = (i + <span class="number">1</span>) <span class="built_in">Mod</span> <span class="number">256</span></span><br><span class="line">        j = (j + s(i)) <span class="built_in">Mod</span> <span class="number">256</span></span><br><span class="line">        temp = s(i)</span><br><span class="line">        s(i) = s(j)</span><br><span class="line">        s(j) = temp</span><br><span class="line">        </span><br><span class="line">        <span class="comment">&#x27; 鍔犲瘑骞惰浆涓哄崄鍏繘鍒?</span></span><br><span class="line">        <span class="keyword">Dim</span> plainChar, cipherByte</span><br><span class="line">        plainChar = Asc(<span class="keyword">Mid</span>(sMessage, pos, <span class="number">1</span>)) <span class="comment">&#x27; 鏄庢枃鎸堿SCII澶勭悊</span></span><br><span class="line">        cipherByte = s((s(i) + s(j)) <span class="built_in">Mod</span> <span class="number">256</span>) <span class="built_in">Xor</span> plainChar</span><br><span class="line">        outHex = outHex &amp; Right(<span class="string">&quot;0&quot;</span> &amp; Hex(cipherByte), <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">Next</span></span><br><span class="line">    </span><br><span class="line">    RunRC = outHex</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&#x27; 涓婚獙璇侀€昏緫</span></span><br><span class="line"><span class="keyword">If</span> LCase(RunRC(flag, qwfe)) = LCase(wefbuwiue) <span class="keyword">Then</span></span><br><span class="line">    MsgBox <span class="string">&quot;Congratulations! Correct FLAG!&quot;</span></span><br><span class="line"><span class="keyword">Else</span></span><br><span class="line">    MsgBox <span class="string">&quot;Wrong flag.&quot;</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>RC4解密，密钥为<strong>rc4key</strong></p>
<p><img src="/2025/04/07/XYCTF2025/1.png"></p>
<p>flag{We1c0me_t0_XYCTF_2025_reverse_ch@lleng3_by_th3_w@y_p3cd0wn‘s_chall_is_r3@lly_gr3@t_&amp;_fuN!}</p>
<h2 id="ezVM"><a href="#ezVM" class="headerlink" title="ezVM"></a>ezVM</h2><p>通过字符串界面里的unicorn和加密函数的一些特征发现是使用了unicorn框架调用了一串代码。</p>
<p>找一个使用unicorn框架的程序进行bindiff恢复一些unicorn函数的符号。</p>
<p>发现是调用了一串ARM64的代码字节进行模拟执行，将输入字符串传入加密返回，并附上了一些data和栈空间初始化。</p>
<p><img src="/2025/04/07/XYCTF2025/2.png"></p>
<p><img src="/2025/04/07/XYCTF2025/4.png"></p>
<p>将以上调用write写入的数据提取，随便找一个ARM64框架的.so复制到对应地址，以便反编译看代码。</p>
<p>最后得到一个函数，很清晰的看出里面是一个VM虚拟机执行的流程。</p>
<p><img src="/2025/04/07/XYCTF2025/5.png"></p>
<p>使用c++编写代码调用unicorn库进行模拟。</p>
<p>使用Hook，在关键计算地址处进行Hook，输出各个计算流程以及数据。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;data.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;unicorn/unicorn.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;unicorn-import.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">hook_code</span><span class="params">(uc_engine* uc, <span class="type">uint64_t</span> address, <span class="type">uint32_t</span> size, <span class="type">void</span>* user_data)</span> </span>&#123;</span><br><span class="line">    <span class="type">uint64_t</span> w0,w1,w2,w3,w4;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (address == <span class="number">0x1fac</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W1, &amp;w1);</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W0, &amp;w0);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;W3 = W1 ^ W0 --- %llx ^ %llx = %llx\n&quot;</span>, w1,w0,w1^w0);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (address == <span class="number">0x2BE4</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W1, &amp;w1);</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W0, &amp;w0);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;W3 = W1 &gt;&gt; W0 --- %llx &gt;&gt; %llx = %llx\n&quot;</span>, w1, w0, w1 &gt;&gt; w0);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (address == <span class="number">0x2DB4</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W1, &amp;w1);</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W0, &amp;w0);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;W3 = W1 &lt;&lt; W0 --- %llx &lt;&lt; %llx = %llx\n&quot;</span>, w1, w0, w1 &lt;&lt; w0);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (address == <span class="number">0x232C</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W3, &amp;w3);</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W0, &amp;w0);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;W2 = W0 &amp; W3 --- %llx &amp; %llx = %llx\n&quot;</span>, w0, w3, w0 &amp; w3);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (address == <span class="number">0x2054</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W3, &amp;w3);</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W0, &amp;w0);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;W2 = W0 ^ W3 --- %llx ^ %llx = %llx\n&quot;</span>, w0, w3, w3 ^ w0);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (address == <span class="number">0x2238</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W3, &amp;w3);</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W0, &amp;w0);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;W2 = W0 ^ W3 --- %llx ^ %llx = %llx\n&quot;</span>, w0, w3, w3 ^ w0);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (address == <span class="number">0x2180</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W1, &amp;w1);</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W4, &amp;w4);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;W1 = W1 ^ W4 --- %llx ^ %llx = %llx\n&quot;</span>, w1, w4, w1 ^ w4);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (address == <span class="number">0x1CC4</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W0, &amp;w0);</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W1, &amp;w1);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;W2 = W1 + W0 --- %llx + %llx = %llx\n&quot;</span>, w1, w0, w1 + w0);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (address == <span class="number">0x1A0C</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W0, &amp;w0);</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W1, &amp;w1);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;W2 = W1 + W0 --- %llx + %llx = %llx\n&quot;</span>, w1, w0, w1 + w0);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">uint8_t</span> Input[] = <span class="string">&quot;11112222111111111111111111111111&quot;</span>;</span><br><span class="line">    uc_engine* uc&#123;&#125;;</span><br><span class="line">    uc_hook hook;</span><br><span class="line">    <span class="type">uint64_t</span> InputAddr = <span class="number">0x14C28</span>;</span><br><span class="line">    <span class="type">uint64_t</span> Stack = <span class="number">0x7F0000</span>;</span><br><span class="line">    <span class="type">uint8_t</span> MyEncFlag[<span class="number">100</span>]&#123;&#125;;</span><br><span class="line">    <span class="type">uint64_t</span> Base = <span class="number">0x0000000001000000</span>;</span><br><span class="line">    <span class="built_in">uc_open</span>(uc_arch::UC_ARCH_ARM64, uc_mode::UC_MODE_ARM, &amp;uc);</span><br><span class="line">    <span class="built_in">uc_mem_map</span>(uc, <span class="number">0</span>, Base, UC_PROT_ALL);</span><br><span class="line">    <span class="built_in">uc_mem_map</span>(uc, Stack - <span class="number">4096</span>, <span class="number">0x4000</span>, UC_PROT_ALL);</span><br><span class="line">    <span class="built_in">uc_hook_add</span>(uc, &amp;hook, UC_HOOK_CODE, hook_code, <span class="literal">NULL</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">uc_mem_write</span>(uc, <span class="number">0x14C28</span>, (LPVOID)&amp;Input, <span class="number">0x20u</span>);</span><br><span class="line">    <span class="built_in">uc_mem_write</span>(uc, <span class="number">0x0C70</span>, (LPVOID)&amp;Code, <span class="number">8840u</span>);</span><br><span class="line">    <span class="built_in">uc_mem_write</span>(uc, <span class="number">0x14010</span>, (LPVOID)Data1, <span class="number">0x9B8u</span>);</span><br><span class="line">    <span class="built_in">uc_mem_write</span>(uc, <span class="number">0x30F0</span>, (LPVOID)&amp;Data2, <span class="number">0x54u</span>);</span><br><span class="line">    <span class="built_in">uc_mem_write</span>(uc, <span class="number">0x149E8</span>, (LPVOID)&amp;Data3, <span class="number">8u</span>);</span><br><span class="line">    <span class="built_in">uc_reg_write</span>(uc, <span class="number">0xC7</span>, (LPVOID)&amp;InputAddr);<span class="comment">// X0</span></span><br><span class="line">    <span class="built_in">uc_reg_write</span>(uc, <span class="number">4</span>, (LPVOID)&amp;Stack);       <span class="comment">// SP</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">uc_emu_start</span>(uc, <span class="number">0x0C70</span>, <span class="number">0x2EF4</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uc_mem_read</span>(uc, InputAddr, &amp;MyEncFlag, <span class="number">48</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%X &quot;</span>, MyEncFlag[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">uc_close</span>(uc);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后运行输出得到一个vm加密流程</p>
<p>以下是部分输出内容。</p>
<p>output:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line">W3 = W1 &lt;&lt; W0 --- <span class="number">4</span> &lt;&lt; <span class="number">0</span> = <span class="number">4</span></span><br><span class="line">W3 = W1 &lt;&lt; W0 --- <span class="number">4</span> &lt;&lt; <span class="number">1</span> = <span class="number">8</span></span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">32323232</span> &gt;&gt; <span class="number">5</span> = <span class="number">1919191</span></span><br><span class="line">W3 = W1 &lt;&lt; W0 --- <span class="number">32323232</span> &lt;&lt; <span class="number">6</span> = c8c8c8c80</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">1919191</span> ^ <span class="number">8</span>c8c8c80 = <span class="number">8</span>d1d1d11</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">32323232</span> ^ <span class="number">11223344</span> = <span class="number">23100176</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">8</span>d1d1d11 + <span class="number">23100176</span> = b02d<span class="number">1e87</span></span><br><span class="line">W2 = W0 &amp; W3 --- <span class="number">0</span> &amp; <span class="number">3</span> = <span class="number">0</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">776</span>f6853 + <span class="number">0</span> = <span class="number">776</span>f6853</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">776</span>f6853 ^ abab1212 = dcc47a41</span><br><span class="line">W3 = W1 ^ W0 --- b02d<span class="number">1e87</span> ^ dcc47a41 = <span class="number">6</span>ce964c6</span><br><span class="line">W2 = W1 + W0 --- <span class="number">6</span>ce964c6 + <span class="number">31313131</span> = <span class="number">9e1</span>a95f7</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">9e1</span>a95f7 &gt;&gt; <span class="number">4</span> = <span class="number">9e1</span>a95f</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- <span class="number">9e1</span>a95f7 &lt;&lt; <span class="number">7</span> = <span class="number">4</span>f0d4afb80</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">9e1</span>a95f ^ d4afb80 = <span class="number">4</span>ab52df</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">9e1</span>a95f7 ^ <span class="number">55667788</span> = cb7ce27f</span><br><span class="line">W2 = W1 + W0 --- <span class="number">4</span>ab52df + cb7ce27f = d028355e</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">5</span>f5fe<span class="number">6e7</span> &gt;&gt; b = bebfc</span><br><span class="line">W2 = W0 &amp; W3 --- bebfc &amp; <span class="number">3</span> = <span class="number">0</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">776</span>f6853 + <span class="number">5</span>f5fe<span class="number">6e7</span> = d6cf4f3a</span><br><span class="line">W2 = W0 ^ W3 --- d6cf4f3a ^ <span class="number">23235566</span> = f5ec1a5c</span><br><span class="line">W3 = W1 ^ W0 --- f5ec1a5c ^ d028355e = <span class="number">25</span>c42f02</span><br><span class="line">W2 = W1 + W0 --- <span class="number">25</span>c42f02 + <span class="number">32323232</span> = <span class="number">57</span>f66134</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">57</span>f66134 &gt;&gt; <span class="number">5</span> = <span class="number">2</span>bfb309</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- <span class="number">57</span>f66134 &lt;&lt; <span class="number">6</span> = <span class="number">15</span>fd984d00</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">2</span>bfb309 ^ fd984d00 = ff27fe09</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">57</span>f66134 ^ <span class="number">11223344</span> = <span class="number">46</span>d45270</span><br><span class="line">W2 = W1 + W0 --- ff27fe09 + <span class="number">46</span>d45270 = <span class="number">145</span>fc5079</span><br><span class="line">W2 = W0 &amp; W3 --- <span class="number">5</span>f5fe<span class="number">6e7</span> &amp; <span class="number">3</span> = <span class="number">3</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">74696564</span> + <span class="number">5</span>f5fe<span class="number">6e7</span> = d3c94c4b</span><br><span class="line">W2 = W0 ^ W3 --- d3c94c4b ^ abab1212 = <span class="number">78625e59</span></span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">45</span>fc5079 ^ <span class="number">78625e59</span> = <span class="number">3</span>d<span class="number">9e0</span>e20</span><br><span class="line">W2 = W1 + W0 --- <span class="number">3</span>d<span class="number">9e0</span>e20 + <span class="number">9e1</span>a95f7 = dbb8a417</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- dbb8a417 &gt;&gt; <span class="number">4</span> = dbb8a41</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- dbb8a417 &lt;&lt; <span class="number">7</span> = <span class="number">6</span>ddc520b80</span><br><span class="line">W3 = W1 ^ W0 --- dbb8a41 ^ dc520b80 = d<span class="number">1e981</span>c1</span><br><span class="line">W2 = W0 ^ W3 --- dbb8a417 ^ <span class="number">55667788</span> = <span class="number">8</span>eded39f</span><br><span class="line">W2 = W1 + W0 --- d<span class="number">1e981</span>c1 + <span class="number">8</span>eded39f = <span class="number">160</span>c85560</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- bebfcdce &gt;&gt; b = <span class="number">17</span>d7f9</span><br><span class="line">W2 = W0 &amp; W3 --- <span class="number">17</span>d7f9 &amp; <span class="number">3</span> = <span class="number">1</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">656</span>b616d + bebfcdce = <span class="number">1242</span>b2f3b</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">242</span>b2f3b ^ <span class="number">23235566</span> = <span class="number">7087</span>a5d</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">7087</span>a5d ^ <span class="number">60</span>c85560 = <span class="number">67</span>c02f3d</span><br><span class="line">W2 = W1 + W0 --- <span class="number">67</span>c02f3d + <span class="number">57</span>f66134 = bfb69071</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- bfb69071 &gt;&gt; <span class="number">5</span> = <span class="number">5</span>fdb483</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- bfb69071 &lt;&lt; <span class="number">6</span> = <span class="number">2</span>feda41c40</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">5</span>fdb483 ^ eda41c40 = e859a8c3</span><br><span class="line">W2 = W0 ^ W3 --- bfb69071 ^ <span class="number">11223344</span> = ae94a335</span><br><span class="line">W2 = W1 + W0 --- e859a8c3 + ae94a335 = <span class="number">196</span>ee4bf8</span><br><span class="line">W2 = W0 &amp; W3 --- bebfcdce &amp; <span class="number">3</span> = <span class="number">2</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">616</span>d5f72 + bebfcdce = <span class="number">1202</span>d2d40</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">202</span>d2d40 ^ abab1212 = <span class="number">8</span>b863f52</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">96</span>ee4bf8 ^ <span class="number">8</span>b863f52 = <span class="number">1</span>d6874aa</span><br><span class="line">W2 = W1 + W0 --- <span class="number">1</span>d6874aa + dbb8a417 = f92118c1</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- f92118c1 &gt;&gt; <span class="number">4</span> = f92118c</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- f92118c1 &lt;&lt; <span class="number">7</span> = <span class="number">7</span>c908c6080</span><br><span class="line">W3 = W1 ^ W0 --- f92118c ^ <span class="number">908</span>c6080 = <span class="number">9</span>f<span class="number">1e710</span>c</span><br><span class="line">W2 = W0 ^ W3 --- f92118c1 ^ <span class="number">55667788</span> = ac476f49</span><br><span class="line">W2 = W1 + W0 --- <span class="number">9</span>f<span class="number">1e710</span>c + ac476f49 = <span class="number">14</span>b<span class="number">65e055</span></span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">1e1f</span>b4b5 &gt;&gt; b = <span class="number">3</span>c3f6</span><br><span class="line">W2 = W0 &amp; W3 --- <span class="number">3</span>c3f6 &amp; <span class="number">3</span> = <span class="number">2</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">616</span>d5f72 + <span class="number">1e1f</span>b4b5 = <span class="number">7</span>f8d1427</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">7</span>f8d1427 ^ <span class="number">23235566</span> = <span class="number">5</span>cae4141</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">5</span>cae4141 ^ <span class="number">4</span>b<span class="number">65e055</span> = <span class="number">17</span>cba114</span><br><span class="line">W2 = W1 + W0 --- <span class="number">17</span>cba114 + bfb69071 = d7823185</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- d7823185 &gt;&gt; <span class="number">5</span> = <span class="number">6</span>bc118c</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- d7823185 &lt;&lt; <span class="number">6</span> = <span class="number">35e08</span>c6140</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">6</span>bc118c ^ e08c6140 = e63070cc</span><br><span class="line">W2 = W0 ^ W3 --- d7823185 ^ <span class="number">11223344</span> = c6a002c1</span><br><span class="line">W2 = W1 + W0 --- e63070cc + c6a002c1 = <span class="number">1</span>acd0738d</span><br><span class="line">W2 = W0 &amp; W3 --- <span class="number">1e1f</span>b4b5 &amp; <span class="number">3</span> = <span class="number">1</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">656</span>b616d + <span class="number">1e1f</span>b4b5 = <span class="number">838</span>b1622</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">838</span>b1622 ^ abab1212 = <span class="number">28200430</span></span><br><span class="line">W3 = W1 ^ W0 --- acd0738d ^ <span class="number">28200430</span> = <span class="number">84</span>f077bd</span><br><span class="line">W2 = W1 + W0 --- <span class="number">84</span>f077bd + f92118c1 = <span class="number">17e11907</span>e</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">7e11907</span>e &gt;&gt; <span class="number">4</span> = <span class="number">7e11907</span></span><br><span class="line">W3 = W1 &lt;&lt; W0 --- <span class="number">7e11907</span>e &lt;&lt; <span class="number">7</span> = <span class="number">3</span>f08c83f00</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">7e11907</span> ^ <span class="number">8</span>c83f00 = f292607</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">7e11907</span>e ^ <span class="number">55667788</span> = <span class="number">2</span>b<span class="number">77e7f</span>6</span><br><span class="line">W2 = W1 + W0 --- f292607 + <span class="number">2</span>b<span class="number">77e7f</span>6 = <span class="number">3</span>aa10dfd</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">7</span>d7f9b9c &gt;&gt; b = faff3</span><br><span class="line">W2 = W0 &amp; W3 --- faff3 &amp; <span class="number">3</span> = <span class="number">3</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">74696564</span> + <span class="number">7</span>d7f9b9c = f<span class="number">1e90100</span></span><br><span class="line">W2 = W0 ^ W3 --- f<span class="number">1e90100</span> ^ <span class="number">23235566</span> = d2ca5466</span><br><span class="line">W3 = W1 ^ W0 --- d2ca5466 ^ <span class="number">3</span>aa10dfd = e86b599b</span><br><span class="line">W2 = W1 + W0 --- e86b599b + d7823185 = <span class="number">1</span>bfed8b20</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- bfed8b20 &gt;&gt; <span class="number">5</span> = <span class="number">5</span>ff6c59</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- bfed8b20 &lt;&lt; <span class="number">6</span> = <span class="number">2</span>ffb62c800</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">5</span>ff6c59 ^ fb62c800 = fe9da459</span><br><span class="line">W2 = W0 ^ W3 --- bfed8b20 ^ <span class="number">11223344</span> = aecfb864</span><br><span class="line">W2 = W1 + W0 --- fe9da459 + aecfb864 = <span class="number">1</span>ad6d5cbd</span><br><span class="line">W2 = W0 &amp; W3 --- <span class="number">7</span>d7f9b9c &amp; <span class="number">3</span> = <span class="number">0</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">776</span>f6853 + <span class="number">7</span>d7f9b9c = f4ef03ef</span><br><span class="line">W2 = W0 ^ W3 --- f4ef03ef ^ abab1212 = <span class="number">5</span>f4411fd</span><br><span class="line">W3 = W1 ^ W0 --- ad6d5cbd ^ <span class="number">5</span>f4411fd = f2294d40</span><br><span class="line">W2 = W1 + W0 --- f2294d40 + <span class="number">7e11907</span>e = <span class="number">1703</span>addbe</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">703</span>addbe &gt;&gt; <span class="number">4</span> = <span class="number">703</span>addb</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- <span class="number">703</span>addbe &lt;&lt; <span class="number">7</span> = <span class="number">381</span>d6edf00</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">703</span>addb ^ <span class="number">1</span>d6edf00 = <span class="number">1</span>a6d72db</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">703</span>addbe ^ <span class="number">55667788</span> = <span class="number">255</span>caa36</span><br><span class="line">W2 = W1 + W0 --- <span class="number">1</span>a6d72db + <span class="number">255</span>caa36 = <span class="number">3</span>fca1d11</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- dcdf8283 &gt;&gt; b = <span class="number">1</span>b9bf0</span><br><span class="line">W2 = W0 &amp; W3 --- <span class="number">1</span>b9bf0 &amp; <span class="number">3</span> = <span class="number">0</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">776</span>f6853 + dcdf8283 = <span class="number">1544</span>eead6</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">544</span>eead6 ^ <span class="number">23235566</span> = <span class="number">776</span>dbfb0</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">776</span>dbfb0 ^ <span class="number">3</span>fca1d11 = <span class="number">48</span>a7a2a1</span><br><span class="line">W2 = W1 + W0 --- <span class="number">48</span>a7a2a1 + bfed8b20 = <span class="number">108952</span>dc1</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">8952</span>dc1 &gt;&gt; <span class="number">5</span> = <span class="number">44</span>a96e</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- <span class="number">8952</span>dc1 &lt;&lt; <span class="number">6</span> = <span class="number">2254</span>b7040</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">44</span>a96e ^ <span class="number">254</span>b7040 = <span class="number">250</span>fd92e</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">8952</span>dc1 ^ <span class="number">11223344</span> = <span class="number">19</span>b<span class="number">71e85</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">250</span>fd92e + <span class="number">19</span>b<span class="number">71e85</span> = <span class="number">3</span>ec6f7b3</span><br><span class="line">W2 = W0 &amp; W3 --- dcdf8283 &amp; <span class="number">3</span> = <span class="number">3</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">74696564</span> + dcdf8283 = <span class="number">15148e7</span>e7</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">5148e7</span>e7 ^ abab1212 = fae3f5f5</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">3</span>ec6f7b3 ^ fae3f5f5 = c4250246</span><br><span class="line">W2 = W1 + W0 --- c4250246 + <span class="number">703</span>addbe = <span class="number">1345</span>fe004</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">345</span>fe004 &gt;&gt; <span class="number">4</span> = <span class="number">345</span>fe00</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- <span class="number">345</span>fe004 &lt;&lt; <span class="number">7</span> = <span class="number">1</span>a2ff00200</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">345</span>fe00 ^ <span class="number">2</span>ff00200 = <span class="number">2</span>cb5fc00</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">345</span>fe004 ^ <span class="number">55667788</span> = <span class="number">6139978</span>c</span><br><span class="line">W2 = W1 + W0 --- <span class="number">2</span>cb5fc00 + <span class="number">6139978</span>c = <span class="number">8</span>def938c</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">3</span>c3f696a &gt;&gt; b = <span class="number">787</span>ed</span><br><span class="line">W2 = W0 &amp; W3 --- <span class="number">787</span>ed &amp; <span class="number">3</span> = <span class="number">1</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">656</span>b616d + <span class="number">3</span>c3f696a = a1aacad7</span><br><span class="line">W2 = W0 ^ W3 --- a1aacad7 ^ <span class="number">23235566</span> = <span class="number">82899</span>fb1</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">82899</span>fb1 ^ <span class="number">8</span>def938c = f660c3d</span><br><span class="line">W2 = W1 + W0 --- f660c3d + <span class="number">8952</span>dc1 = <span class="number">17</span>fb39fe</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">17</span>fb39fe &gt;&gt; <span class="number">5</span> = bfd9cf</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- <span class="number">17</span>fb39fe &lt;&lt; <span class="number">6</span> = <span class="number">5</span>fece7f80</span><br><span class="line">W3 = W1 ^ W0 --- bfd9cf ^ fece7f80 = fe71a64f</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">17</span>fb39fe ^ <span class="number">11223344</span> = <span class="number">6</span>d90aba</span><br><span class="line">W2 = W1 + W0 --- fe71a64f + <span class="number">6</span>d90aba = <span class="number">1054</span>ab109</span><br><span class="line">W2 = W0 &amp; W3 --- <span class="number">3</span>c3f696a &amp; <span class="number">3</span> = <span class="number">2</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">616</span>d5f72 + <span class="number">3</span>c3f696a = <span class="number">9</span>dacc8dc</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">9</span>dacc8dc ^ abab1212 = <span class="number">3607</span>dace</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">54</span>ab109 ^ <span class="number">3607</span>dace = <span class="number">334</span>d6bc7</span><br><span class="line">W2 = W1 + W0 --- <span class="number">334</span>d6bc7 + <span class="number">345</span>fe004 = <span class="number">67</span>ad4bcb</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">67</span>ad4bcb &gt;&gt; <span class="number">4</span> = <span class="number">67</span>ad4bc</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- <span class="number">67</span>ad4bcb &lt;&lt; <span class="number">7</span> = <span class="number">33</span>d6a<span class="number">5e580</span></span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">67</span>ad4bc ^ d6a<span class="number">5e580</span> = d0df313c</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">67</span>ad4bcb ^ <span class="number">55667788</span> = <span class="number">32</span>cb3c43</span><br><span class="line">W2 = W1 + W0 --- d0df313c + <span class="number">32</span>cb3c43 = <span class="number">103</span>aa6d7f</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">9</span>b9f5051 &gt;&gt; b = <span class="number">1373</span>ea</span><br><span class="line">W2 = W0 &amp; W3 --- <span class="number">1373</span>ea &amp; <span class="number">3</span> = <span class="number">2</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">616</span>d5f72 + <span class="number">9</span>b9f5051 = fd0cafc3</span><br><span class="line">W2 = W0 ^ W3 --- fd0cafc3 ^ <span class="number">23235566</span> = de2ffaa5</span><br><span class="line">W3 = W1 ^ W0 --- de2ffaa5 ^ <span class="number">3</span>aa6d7f = dd8597da</span><br><span class="line">W2 = W1 + W0 --- dd8597da + <span class="number">17</span>fb39fe = f580d1d8</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- f580d1d8 &gt;&gt; <span class="number">5</span> = <span class="number">7</span>ac068e</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- f580d1d8 &lt;&lt; <span class="number">6</span> = <span class="number">3</span>d60347600</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">7</span>ac068e ^ <span class="number">60347600</span> = <span class="number">6798708</span>e</span><br><span class="line">W2 = W0 ^ W3 --- f580d1d8 ^ <span class="number">11223344</span> = e4a<span class="number">2e29</span>c</span><br><span class="line">W2 = W1 + W0 --- <span class="number">6798708</span>e + e4a<span class="number">2e29</span>c = <span class="number">14</span>c3b532a</span><br><span class="line">W2 = W0 &amp; W3 --- <span class="number">9</span>b9f5051 &amp; <span class="number">3</span> = <span class="number">1</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">656</span>b616d + <span class="number">9</span>b9f5051 = <span class="number">1010</span>ab1be</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">10</span>ab1be ^ abab1212 = aaa1a3ac</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">4</span>c3b532a ^ aaa1a3ac = e69af086</span><br><span class="line">W2 = W1 + W0 --- e69af086 + <span class="number">67</span>ad4bcb = <span class="number">14e483</span>c51</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">4e483</span>c51 &gt;&gt; <span class="number">4</span> = <span class="number">4e483</span>c5</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- <span class="number">4e483</span>c51 &lt;&lt; <span class="number">7</span> = <span class="number">27241e2880</span></span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">4e483</span>c5 ^ <span class="number">241e2880</span> = <span class="number">20</span>faab45</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">4e483</span>c51 ^ <span class="number">55667788</span> = <span class="number">1</span>b<span class="number">2e4</span>bd9</span><br><span class="line">W2 = W1 + W0 --- <span class="number">20</span>faab45 + <span class="number">1</span>b<span class="number">2e4</span>bd9 = <span class="number">3</span>c28f71e</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- faff3738 &gt;&gt; b = <span class="number">1</span>f5fe6</span><br><span class="line">W2 = W0 &amp; W3 --- <span class="number">1</span>f5fe6 &amp; <span class="number">3</span> = <span class="number">2</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">616</span>d5f72 + faff3738 = <span class="number">15</span>c6c96aa</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">5</span>c6c96aa ^ <span class="number">23235566</span> = <span class="number">7</span>f4fc3cc</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">7</span>f4fc3cc ^ <span class="number">3</span>c28f71e = <span class="number">436734</span>d2</span><br><span class="line">W2 = W1 + W0 --- <span class="number">436734</span>d2 + f580d1d8 = <span class="number">138e806</span>aa</span><br></pre></td></tr></table></figure>

<p>通过观察可以发现是一个魔改的XTea加密。</p>
<p>通过对比标准XTea加密流程，可以得到里面参与计算的4个key值 <strong>{0x776f6853,0x656b616d,0x616d5f72,0x74696564}</strong> 以及delta值 <strong>0x5f5fe6e7</strong></p>
<p>写出对应加密的c++代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">encipher</span><span class="params">(<span class="type">uint32_t</span> v[<span class="number">2</span>], <span class="type">const</span> <span class="type">uint32_t</span> key[<span class="number">4</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>], sum = <span class="number">0</span>, delta = <span class="number">0x5f5fe6e7</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">72</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> tmp = (((v1 &lt;&lt; <span class="number">6</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + (v1 ^ <span class="number">0x11223344</span>));</span><br><span class="line">        <span class="keyword">auto</span> tmp2 = (((key[sum &amp; <span class="number">3</span>] + sum) ^ <span class="number">0xabab1212</span>) ^ tmp);</span><br><span class="line">        v0 += tmp2;</span><br><span class="line">        sum += delta;</span><br><span class="line">        <span class="keyword">auto</span> tmp3 = (((v0 &lt;&lt; <span class="number">7</span>) ^ (v0 &gt;&gt; <span class="number">4</span>)) + (v0 ^ <span class="number">0x55667788</span>));</span><br><span class="line">        <span class="keyword">auto</span> tmp4 = ((key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>] + sum) ^ <span class="number">0x23235566</span> ^ tmp3);</span><br><span class="line">        v1 += tmp4;</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = v0;</span><br><span class="line">    v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解密代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">decipher</span><span class="params">(<span class="type">uint32_t</span> v[<span class="number">2</span>], <span class="type">const</span> <span class="type">uint32_t</span> key[<span class="number">4</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>], sum = <span class="number">0x5f5fe6e7</span> * <span class="number">72</span>, delta = <span class="number">0x5f5fe6e7</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">72</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> tmp3 = (((v0 &lt;&lt; <span class="number">7</span>) ^ (v0 &gt;&gt; <span class="number">4</span>)) + (v0 ^ <span class="number">0x55667788</span>));</span><br><span class="line">        <span class="keyword">auto</span> tmp4 = ((key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>] + sum) ^ <span class="number">0x23235566</span> ^ tmp3);</span><br><span class="line">        v1 -= tmp4;</span><br><span class="line">        sum -= delta;</span><br><span class="line">        <span class="keyword">auto</span> tmp = (((v1 &lt;&lt; <span class="number">6</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + (v1 ^ <span class="number">0x11223344</span>));</span><br><span class="line">        <span class="keyword">auto</span> tmp2 = (((key[sum &amp; <span class="number">3</span>] + sum) ^ <span class="number">0xabab1212</span>) ^ tmp);</span><br><span class="line">        v0 -= tmp2;</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = v0;</span><br><span class="line">    v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>提取chal程序中的密文，进行解密即可。</p>
<p>完整解密代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">decipher</span><span class="params">(<span class="type">uint32_t</span> v[<span class="number">2</span>], <span class="type">const</span> <span class="type">uint32_t</span> key[<span class="number">4</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>], sum = <span class="number">0x5f5fe6e7</span> * <span class="number">72</span>, delta = <span class="number">0x5f5fe6e7</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">72</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> tmp3 = (((v0 &lt;&lt; <span class="number">7</span>) ^ (v0 &gt;&gt; <span class="number">4</span>)) + (v0 ^ <span class="number">0x55667788</span>));</span><br><span class="line">        <span class="keyword">auto</span> tmp4 = ((key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>] + sum) ^ <span class="number">0x23235566</span> ^ tmp3);</span><br><span class="line">        v1 -= tmp4;</span><br><span class="line">        sum -= delta;</span><br><span class="line">        <span class="keyword">auto</span> tmp = (((v1 &lt;&lt; <span class="number">6</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + (v1 ^ <span class="number">0x11223344</span>));</span><br><span class="line">        <span class="keyword">auto</span> tmp2 = (((key[sum &amp; <span class="number">3</span>] + sum) ^ <span class="number">0xabab1212</span>) ^ tmp);</span><br><span class="line">        v0 -= tmp2;</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = v0;</span><br><span class="line">    v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> key[]&#123;</span><br><span class="line">        <span class="number">0x776f6853</span>,</span><br><span class="line">        <span class="number">0x656b616d</span>,</span><br><span class="line">        <span class="number">0x616d5f72</span>,</span><br><span class="line">        <span class="number">0x74696564</span>&#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> Encflag[<span class="number">8</span>] = &#123;</span><br><span class="line">        <span class="number">0x696C2E9A</span>, <span class="number">0x76ADE8E1</span>, <span class="number">0xE67D5CA4</span>, <span class="number">0x5C76BD38</span>,</span><br><span class="line">        <span class="number">0xB7AC0787</span>, <span class="number">0xBFEA0C65</span>, <span class="number">0x01C2FF10</span>, <span class="number">0x6D16FD38</span>&#125;;</span><br><span class="line">    <span class="built_in">decipher</span>(Encflag, key);</span><br><span class="line">    <span class="built_in">decipher</span>((<span class="type">uint32_t</span> *)((<span class="type">uint64_t</span>)Encflag + <span class="number">8</span>), key);</span><br><span class="line">    <span class="built_in">decipher</span>((<span class="type">uint32_t</span> *)((<span class="type">uint64_t</span>)Encflag + <span class="number">16</span>), key);</span><br><span class="line">    <span class="built_in">decipher</span>((<span class="type">uint32_t</span> *)((<span class="type">uint64_t</span>)Encflag + <span class="number">24</span>), key);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.32s\n&quot;</span>, Encflag);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>XYCTF{fun_un1c0rn_with_4rm64_VM}</p>
<h2 id="Moon"><a href="#Moon" class="headerlink" title="Moon"></a>Moon</h2><p>跟到moon.xor_crypt实际加密处。</p>
<p><img src="/2025/04/07/XYCTF2025/6.png"></p>
<p>发现是进行了单次xor，并加入到一个list中，前后过程不清楚。</p>
<p>断在xor这个命令，运行附加调试，随便输入一串1</p>
<p><img src="/2025/04/07/XYCTF2025/7.png"></p>
<p><img src="/2025/04/07/XYCTF2025/8.png"></p>
<p>发现是输入的’1’和一个0x24进行xor，多运行几次发现就是将输入的字符串都异或上一些值。</p>
<p>直接断在return处，v20是最后将list转成Bytes的结果。</p>
<p><img src="/2025/04/07/XYCTF2025/9.png"></p>
<p>发现是28长度的一串字节，从0x15开始的，就是我们输入字符串长度以及异或完的结果。</p>
<p><img src="/2025/04/07/XYCTF2025/10.png"></p>
<p>继续运行会返回到check_flag代码处，底下有一个RichCompare比较两个数据。</p>
<p><img src="/2025/04/07/XYCTF2025/11.png"></p>
<p>v45可以看到就是将刚刚v20的bytes直接unhex转成了一串字符串。</p>
<p><img src="/2025/04/07/XYCTF2025/12.png"></p>
<p>那么v9就应该是flag的密文，可以数出一共是要35字节。</p>
<p><img src="/2025/04/07/XYCTF2025/13.png"></p>
<p>重新调试运行输入35个1，在check_flag开头断点，把输入的字符串全都patch成0。</p>
<p><img src="/2025/04/07/XYCTF2025/14.png"></p>
<p><img src="/2025/04/07/XYCTF2025/15.png"></p>
<p><img src="/2025/04/07/XYCTF2025/16.png"></p>
<p>最后在RichCompare处就可以得到xor密文的列表。</p>
<p><img src="/2025/04/07/XYCTF2025/17.png"></p>
<p>将v9的密文与这个数据进行xor即可得到flag。</p>
<p><img src="/2025/04/07/XYCTF2025/18.png"></p>
<p>flag{but_y0u_l00k3d_up_@t_th3_mOOn}</p>
<h2 id="Dragon（5m10v3师傅解题）"><a href="#Dragon（5m10v3师傅解题）" class="headerlink" title="Dragon（5m10v3师傅解题）"></a>Dragon（5m10v3师傅解题）</h2><p>.bc 后缀 </p>
<p>反编译为LLVM IR</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">llvm-dis-<span class="number">17</span> Dragon.bc -o Dragon.ll</span><br></pre></td></tr></table></figure>

<p>分析得知为crc64，以两个为一组进行校验，直接爆破就行</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">uint64_t</span> <span class="title">calculate_crc64_direct</span><span class="params">(<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>* data, <span class="type">uint64_t</span> length)</span> </span>&#123;</span><br><span class="line">    <span class="type">uint64_t</span> crc = <span class="number">0xFFFFFFFFFFFFFFFFULL</span>; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">uint64_t</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">        crc ^= ((<span class="type">uint64_t</span>)data[i] &lt;&lt; <span class="number">56</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">uint64_t</span> j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (crc &amp; <span class="number">0x8000000000000000ULL</span>) &#123; </span><br><span class="line">                crc = (crc &lt;&lt; <span class="number">1</span>) ^ <span class="number">0x42F0E1EBA9EA3693ULL</span>; </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                crc = crc &lt;&lt; <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ~crc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">uint64_t</span> enc[<span class="number">12</span>] = &#123;</span><br><span class="line">       <span class="number">-2565957437423125689</span>, </span><br><span class="line">        <span class="number">224890624719110086</span>, </span><br><span class="line">        <span class="number">1357324823849588894</span>, </span><br><span class="line">        - <span class="number">8941695979231947288</span>, </span><br><span class="line">        - <span class="number">253413330424273460</span>, </span><br><span class="line">        - <span class="number">7817463785137710741</span>, </span><br><span class="line">        - <span class="number">5620500441869335673</span>, </span><br><span class="line">        <span class="number">984060876288820705</span>, </span><br><span class="line">        - <span class="number">6993555743080142153</span>, </span><br><span class="line">        - <span class="number">7892488171899690683</span>, </span><br><span class="line">        <span class="number">7190415315123037707</span>, </span><br><span class="line">        - <span class="number">7218240302740981077</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">char</span> flag[<span class="number">25</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    <span class="type">int</span> flag_index = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; <span class="number">12</span>; k++) &#123;</span><br><span class="line">        <span class="type">uint64_t</span> target_crc = enc[k];</span><br><span class="line">        <span class="type">int</span> found = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="type">char</span> c1 = <span class="number">32</span>; c1 &lt; <span class="number">127</span> &amp;&amp; !found; c1++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="type">char</span> c2 = <span class="number">32</span>; c2 &lt; <span class="number">127</span> &amp;&amp; !found; c2++) &#123;</span><br><span class="line">                <span class="type">unsigned</span> <span class="type">char</span> test[<span class="number">2</span>] = &#123; c1, c2 &#125;;</span><br><span class="line">                <span class="type">uint64_t</span> crc = <span class="built_in">calculate_crc64_direct</span>(test, <span class="number">2</span>);</span><br><span class="line">                <span class="keyword">if</span> (crc == target_crc) &#123;</span><br><span class="line">                    flag[flag_index++] = c1;</span><br><span class="line">                    flag[flag_index++] = c2;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    flag[flag_index] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Decrypted flag: %s\n&quot;</span>, flag);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//flag&#123;LLVM_1s_Fun_Ri9h7?&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Summer（5m10v3师傅解题）"><a href="#Summer（5m10v3师傅解题）" class="headerlink" title="Summer（5m10v3师傅解题）"></a>Summer（5m10v3师傅解题）</h2><p>haskell程序</p>
<p>函数式编程语言,这意味着一切都是惰性计算，什么是惰性计算？ 简单来说就是在调用之前不会对该值进行计算</p>
<p>浏览 main 函数，可以看到 hs_main 将 ZCMain_main_closure 作为它的参数，它指向 haskell 程序的真正入口点</p>
<p><img src="/2025/04/07/XYCTF2025/31.png"></p>
<p>ZCMain_main_closure里面我们发现它调用了stg_ap_p_fast，这个是底层函数，主要调用Main_main_closure这个函数</p>
<p><img src="/2025/04/07/XYCTF2025/19.png"></p>
<p>GHCziInternalziBase也是底层函数，主要关注两个参数</p>
<p><img src="/2025/04/07/XYCTF2025/20.png"></p>
<p>第一个参数的地址处的函数为打印字符串</p>
<p><img src="/2025/04/07/XYCTF2025/21.png"></p>
<p><img src="/2025/04/07/XYCTF2025/22.png"></p>
<p>GHCziInternalziList_length 为处理我们的传入的字符串的长度，直接调用的是zdwlenAcc**，**zdwlenAcc 将通过检查下一个是否是列表的末尾来计算 “flagTable” 的长度（这里的”flagTable” 是我自己命名,其实就是存储惰性列表，我们可以根据惰性列表的指针数判断字符串的长度）</p>
<p><img src="/2025/04/07/XYCTF2025/23.png"></p>
<p><img src="/2025/04/07/XYCTF2025/24.png"></p>
<p>我们这里就用flag进行测试，一方面是为了查看他的返回值</p>
<p><img src="/2025/04/07/XYCTF2025/25.png"></p>
<p>此时他是将rbx此处(即为惰性列表的末尾)，可以人工数(即为50)</p>
<p><img src="/2025/04/07/XYCTF2025/26.png"></p>
<p>另外一种为看返回值，第一次断下是返回我们输入字符串的长度，第二次断下是返回密钥的长度，第三次断下是返回密文的长度</p>
<p><img src="/2025/04/07/XYCTF2025/27.png"></p>
<p><img src="/2025/04/07/XYCTF2025/28.png"></p>
<p><img src="/2025/04/07/XYCTF2025/29.png"></p>
<p>另外一处为GHCziInternalziNum_zdfNumIntzuzdczp，这个也是在网上一篇文章看到的,在<strong>add     rbx, [rax]</strong> 在经过几次迭代后，我可以看到一些字符开始出现，此时我们可以得到密钥为<strong>Klingsor’s_Last_Summer</strong></p>
<p><img src="/2025/04/07/XYCTF2025/30.png"></p>
<p>我们在.data段得到了密钥，因此我们可以猜测下面可能为密文,并且下面都是指针+元素的存储形式</p>
<p><img src="/2025/04/07/XYCTF2025/32.png"></p>
<p><img src="/2025/04/07/XYCTF2025/33.png"></p>
<p>然后通过CE调试得到明文和密文，然后得出为rc4+xor</p>
<p><img src="/2025/04/07/XYCTF2025/34.png"></p>
<p><img src="/2025/04/07/XYCTF2025/35.png"></p>
<p>flag{Us3_H@sk3ll_t0_f1nd_th3_truth_1n_th1s_Summ3R}</p>
<h2 id="Lake"><a href="#Lake" class="headerlink" title="Lake"></a>Lake</h2><p>单步跟到主函数。</p>
<p><img src="/2025/04/07/XYCTF2025/36.png"></p>
<p>这边输入字符串后先赋值到了另一个数组，然后进行了一次简易VM计算进行了第一次加密，</p>
<p><img src="/2025/04/07/XYCTF2025/37.png"></p>
<p>然后接着第二次加密，最后循环比较。</p>
<p><img src="/2025/04/07/XYCTF2025/38.png"></p>
<p><img src="/2025/04/07/XYCTF2025/39.png"></p>
<p>发现VM只用到了加减和XOR计算，在这三个地方的关键点打断点，输出寄存器和计算流程，这边为了方便直接复制到代码里面解密，将加减断点里面的输出运算符反过来，输出出来的代码直接复制到代码就是进行解密的流程。</p>
<p><img src="/2025/04/07/XYCTF2025/40.png"></p>
<p><img src="/2025/04/07/XYCTF2025/41.png"></p>
<p><img src="/2025/04/07/XYCTF2025/42.png"></p>
<p>调试输出：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">Input[<span class="number">2</span>] += <span class="number">12</span>;</span><br><span class="line">Input[<span class="number">26</span>] -= <span class="number">85</span>;</span><br><span class="line">Input[<span class="number">35</span>] -= <span class="number">12</span>;</span><br><span class="line">Input[<span class="number">14</span>] += <span class="number">9</span>;</span><br><span class="line">Input[<span class="number">27</span>] -= <span class="number">6</span>;</span><br><span class="line">Input[<span class="number">6</span>] ^= <span class="number">5</span>;</span><br><span class="line">Input[<span class="number">1</span>] ^= <span class="number">5</span>;</span><br><span class="line">Input[<span class="number">27</span>] += <span class="number">14</span>;</span><br><span class="line">Input[<span class="number">25</span>] += <span class="number">3</span>;</span><br><span class="line">Input[<span class="number">26</span>] += <span class="number">4</span>;</span><br><span class="line">Input[<span class="number">4</span>] ^= <span class="number">8</span>;</span><br><span class="line">Input[<span class="number">3</span>] -= <span class="number">12</span>;</span><br><span class="line">Input[<span class="number">12</span>] += <span class="number">10</span>;</span><br><span class="line">Input[<span class="number">37</span>] -= <span class="number">2</span>;</span><br><span class="line">Input[<span class="number">32</span>] -= <span class="number">2</span>;</span><br><span class="line">Input[<span class="number">9</span>] -= <span class="number">12</span>;</span><br><span class="line">Input[<span class="number">26</span>] ^= <span class="number">5</span>;</span><br><span class="line">Input[<span class="number">4</span>] += <span class="number">13</span>;</span><br><span class="line">Input[<span class="number">8</span>] ^= <span class="number">15</span>;</span><br><span class="line">Input[<span class="number">10</span>] += <span class="number">14</span>;</span><br><span class="line">Input[<span class="number">16</span>] -= <span class="number">7</span>;</span><br><span class="line">Input[<span class="number">12</span>] -= <span class="number">7</span>;</span><br><span class="line">Input[<span class="number">34</span>] ^= <span class="number">8</span>;</span><br><span class="line">Input[<span class="number">21</span>] ^= <span class="number">10</span>;</span><br><span class="line">Input[<span class="number">39</span>] -= <span class="number">126</span>;</span><br><span class="line">Input[<span class="number">7</span>] += <span class="number">2</span>;</span><br><span class="line">Input[<span class="number">15</span>] ^= <span class="number">3</span>;</span><br><span class="line">Input[<span class="number">10</span>] ^= <span class="number">10</span>;</span><br><span class="line">Input[<span class="number">34</span>] -= <span class="number">11</span>;</span><br><span class="line">Input[<span class="number">18</span>] += <span class="number">8</span>;</span><br><span class="line">Input[<span class="number">25</span>] += <span class="number">9</span>;</span><br><span class="line">Input[<span class="number">14</span>] ^= <span class="number">6</span>;</span><br><span class="line">Input[<span class="number">0</span>] ^= <span class="number">5</span>;</span><br><span class="line">Input[<span class="number">10</span>] -= <span class="number">8</span>;</span><br><span class="line">Input[<span class="number">27</span>] ^= <span class="number">7</span>;</span><br><span class="line">Input[<span class="number">13</span>] ^= <span class="number">6</span>;</span><br><span class="line">Input[<span class="number">13</span>] ^= <span class="number">4</span>;</span><br><span class="line">Input[<span class="number">23</span>] ^= <span class="number">12</span>;</span><br><span class="line">Input[<span class="number">34</span>] ^= <span class="number">14</span>;</span><br><span class="line">Input[<span class="number">18</span>] += <span class="number">52</span>;</span><br><span class="line">Input[<span class="number">38</span>] -= <span class="number">119</span>;</span><br></pre></td></tr></table></figure>

<p>这也就是第一层加密的解密代码。</p>
<p>第二层加密直接对着写即可，我写的有点问题（懒得改），其中几个字节解密不对，不过根据解密出的flag也能猜出是啥，替换完那几个字节就得到完整的flag。</p>
<p>完整解密代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">decrypt_func</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *data, <span class="type">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> temp[<span class="number">40</span>];</span><br><span class="line">    <span class="built_in">memcpy</span>(temp, data, <span class="number">40</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> base = <span class="number">4</span> * i;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> block[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (base &lt; len)</span><br><span class="line">        &#123;</span><br><span class="line">            block[<span class="number">0</span>] = ((temp[base + <span class="number">2</span>] &amp; <span class="number">0x1F</span>) &lt;&lt; <span class="number">5</span>) | (temp[base + <span class="number">3</span>] &gt;&gt; <span class="number">3</span>);</span><br><span class="line">            block[<span class="number">1</span>] = (temp[base] &gt;&gt; <span class="number">3</span>) | ((temp[base + <span class="number">3</span>] &amp; <span class="number">0x07</span>) &lt;&lt; <span class="number">5</span>);</span><br><span class="line">            block[<span class="number">2</span>] = ((temp[base] &amp; <span class="number">0x07</span>) &lt;&lt; <span class="number">5</span>) | (temp[base + <span class="number">1</span>] &gt;&gt; <span class="number">3</span>);</span><br><span class="line">            block[<span class="number">3</span>] = ((temp[base + <span class="number">1</span>] &amp; <span class="number">0x07</span>) &lt;&lt; <span class="number">5</span>) | (temp[base + <span class="number">2</span>] &gt;&gt; <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span> &amp;&amp; base + j &lt; len; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                data[base + j] = block[j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> Input[<span class="number">48</span>] = &#123;</span><br><span class="line">        <span class="number">0x4A</span>, <span class="number">0xAB</span>, <span class="number">0x9B</span>, <span class="number">0x1B</span>, <span class="number">0x61</span>, <span class="number">0xB1</span>, <span class="number">0xF3</span>, <span class="number">0x32</span>, <span class="number">0xD1</span>, <span class="number">0x8B</span>, <span class="number">0x73</span>, <span class="number">0xEB</span>, <span class="number">0xE9</span>, <span class="number">0x73</span>, <span class="number">0x6B</span>, <span class="number">0x22</span>,</span><br><span class="line">        <span class="number">0x81</span>, <span class="number">0x83</span>, <span class="number">0x23</span>, <span class="number">0x31</span>, <span class="number">0xCB</span>, <span class="number">0x1B</span>, <span class="number">0x22</span>, <span class="number">0xFB</span>, <span class="number">0x25</span>, <span class="number">0xC2</span>, <span class="number">0x81</span>, <span class="number">0x81</span>, <span class="number">0x73</span>, <span class="number">0x22</span>, <span class="number">0xFA</span>, <span class="number">0x03</span>,</span><br><span class="line">        <span class="number">0x9C</span>, <span class="number">0x4B</span>, <span class="number">0x5B</span>, <span class="number">0x49</span>, <span class="number">0x97</span>, <span class="number">0x87</span>, <span class="number">0xDB</span>, <span class="number">0x51</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">decrypt_func</span>(Input, <span class="number">40</span>);</span><br><span class="line">    Input[<span class="number">2</span>] += <span class="number">12</span>;</span><br><span class="line">    Input[<span class="number">26</span>] -= <span class="number">85</span>;</span><br><span class="line">    Input[<span class="number">35</span>] -= <span class="number">12</span>;</span><br><span class="line">    Input[<span class="number">14</span>] += <span class="number">9</span>;</span><br><span class="line">    Input[<span class="number">27</span>] -= <span class="number">6</span>;</span><br><span class="line">    Input[<span class="number">6</span>] ^= <span class="number">5</span>;</span><br><span class="line">    Input[<span class="number">1</span>] ^= <span class="number">5</span>;</span><br><span class="line">    Input[<span class="number">27</span>] += <span class="number">14</span>;</span><br><span class="line">    Input[<span class="number">25</span>] += <span class="number">3</span>;</span><br><span class="line">    Input[<span class="number">26</span>] += <span class="number">4</span>;</span><br><span class="line">    Input[<span class="number">4</span>] ^= <span class="number">8</span>;</span><br><span class="line">    Input[<span class="number">3</span>] -= <span class="number">12</span>;</span><br><span class="line">    Input[<span class="number">12</span>] += <span class="number">10</span>;</span><br><span class="line">    Input[<span class="number">37</span>] -= <span class="number">2</span>;</span><br><span class="line">    Input[<span class="number">32</span>] -= <span class="number">2</span>;</span><br><span class="line">    Input[<span class="number">9</span>] -= <span class="number">12</span>;</span><br><span class="line">    Input[<span class="number">26</span>] ^= <span class="number">5</span>;</span><br><span class="line">    Input[<span class="number">4</span>] += <span class="number">13</span>;</span><br><span class="line">    Input[<span class="number">8</span>] ^= <span class="number">15</span>;</span><br><span class="line">    Input[<span class="number">10</span>] += <span class="number">14</span>;</span><br><span class="line">    Input[<span class="number">16</span>] -= <span class="number">7</span>;</span><br><span class="line">    Input[<span class="number">12</span>] -= <span class="number">7</span>;</span><br><span class="line">    Input[<span class="number">34</span>] ^= <span class="number">8</span>;</span><br><span class="line">    Input[<span class="number">21</span>] ^= <span class="number">10</span>;</span><br><span class="line">    Input[<span class="number">39</span>] -= <span class="number">126</span>;</span><br><span class="line">    Input[<span class="number">7</span>] += <span class="number">2</span>;</span><br><span class="line">    Input[<span class="number">15</span>] ^= <span class="number">3</span>;</span><br><span class="line">    Input[<span class="number">10</span>] ^= <span class="number">10</span>;</span><br><span class="line">    Input[<span class="number">34</span>] -= <span class="number">11</span>;</span><br><span class="line">    Input[<span class="number">18</span>] += <span class="number">8</span>;</span><br><span class="line">    Input[<span class="number">25</span>] += <span class="number">9</span>;</span><br><span class="line">    Input[<span class="number">14</span>] ^= <span class="number">6</span>;</span><br><span class="line">    Input[<span class="number">0</span>] ^= <span class="number">5</span>;</span><br><span class="line">    Input[<span class="number">10</span>] -= <span class="number">8</span>;</span><br><span class="line">    Input[<span class="number">27</span>] ^= <span class="number">7</span>;</span><br><span class="line">    Input[<span class="number">13</span>] ^= <span class="number">6</span>;</span><br><span class="line">    Input[<span class="number">13</span>] ^= <span class="number">4</span>;</span><br><span class="line">    Input[<span class="number">23</span>] ^= <span class="number">12</span>;</span><br><span class="line">    Input[<span class="number">34</span>] ^= <span class="number">14</span>;</span><br><span class="line">    Input[<span class="number">18</span>] += <span class="number">52</span>;</span><br><span class="line">    Input[<span class="number">38</span>] -= <span class="number">119</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.40s\n&quot;</span>, Input);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// flag&#123;L3@rn-ng_1n_0ld_sch00b_@nd_g3x_j0y&#125; -&gt; flag&#123;L3@rn1ng_1n_0ld_sch00l_@nd_g3t_j0y&#125;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>flag{L3@rn1ng_1n_0ld_sch00l_@nd_g3t_j0y}</p>
<h2 id="EzObf"><a href="#EzObf" class="headerlink" title="EzObf"></a>EzObf</h2><p>main_0函数跟入发现有混淆，红框处为原真实汇编指令，其他都是混淆指令。</p>
<p>混淆流程：</p>
<ol>
<li>执行真实指令</li>
<li>call $+5执行pop rax，rax就是call时push到栈的返回地址，也就是pop rax指令的地址。</li>
<li>给ebx赋值，进行rol计算，最后用rax加上或减去（共两种）rbx，得到跳转地址，进行jmp rax。</li>
</ol>
<p>之后每jmp过去一次，那边就都是一样的结构，popfq和pushfq之间就是真实汇编。</p>
<p>deobf的思路即为nop那一堆pop和push，保留真实汇编指令，然后计算跳转地址，手动计算相对地址写jmp，保持代码执行流程。</p>
<p><img src="/2025/04/07/XYCTF2025/43.png"></p>
<p>deobf idc脚本：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> <span class="title">NopCode</span><span class="params">(Addr, Length)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; Length; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">PatchByte</span>(Addr + i, <span class="number">0x90</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="title">rol</span><span class="params">(value, count, bits = <span class="number">32</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    count = count % bits;</span><br><span class="line">    <span class="keyword">return</span> ((value &lt;&lt; count) | (value &gt;&gt; (bits - count))) &amp; ((<span class="number">1</span> &lt;&lt; bits) - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 搜索真实汇编代码的下一个地址</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="title">FindEnd</span><span class="params">(Addr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">0x90</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> v = <span class="built_in">Dword</span>(Addr + i);</span><br><span class="line">        <span class="keyword">if</span> (v == <span class="number">0x5153509C</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> Addr + i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 搜索最后的jmp rax指令</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="title">FindJmpRax</span><span class="params">(Addr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">0x90</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> v = <span class="built_in">Word</span>(Addr + i);</span><br><span class="line">        <span class="keyword">if</span> (v == <span class="number">0xE0FF</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> Addr + i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 搜索call $+5</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="title">FindCall</span><span class="params">(Addr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">0x90</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> v = <span class="built_in">Dword</span>(Addr + i);</span><br><span class="line">        <span class="keyword">if</span> (v == <span class="number">0xE8</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> Addr + i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> StartAddr = <span class="number">0x1401F400D</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 搜索真实汇编代码的下一个指令地址</span></span><br><span class="line">        <span class="keyword">auto</span> EndAddr = <span class="built_in">FindEnd</span>(StartAddr);</span><br><span class="line">        <span class="keyword">if</span> (EndAddr == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 真实汇编代码的字节长度</span></span><br><span class="line">        <span class="keyword">auto</span> CodeLength = EndAddr - StartAddr - <span class="number">13</span>;</span><br><span class="line">        <span class="comment">// 搜索Call $+5</span></span><br><span class="line">        <span class="keyword">auto</span> CallAddr = <span class="built_in">FindCall</span>(StartAddr + <span class="number">13</span> + CodeLength);</span><br><span class="line">        <span class="keyword">if</span> (CallAddr == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// call $+5的下一条指令地址，即call时push到栈的返回地址</span></span><br><span class="line">        <span class="keyword">auto</span> CalcAddr = CallAddr + <span class="number">5</span>;</span><br><span class="line">        <span class="keyword">auto</span> ebx = <span class="built_in">Dword</span>(CalcAddr + <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">auto</span> rol_Value = <span class="built_in">Byte</span>(CalcAddr + <span class="number">8</span>);</span><br><span class="line">        <span class="keyword">auto</span> Mode = <span class="built_in">Dword</span>(CalcAddr + <span class="number">9</span>);</span><br><span class="line">        ebx = <span class="built_in">rol</span>(ebx, rol_Value);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 搜索最尾部的jmp rax指令地址</span></span><br><span class="line">        <span class="keyword">auto</span> JmpRaxAddr = <span class="built_in">FindJmpRax</span>(StartAddr);</span><br><span class="line">        <span class="keyword">if</span> (JmpRaxAddr == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 第一部分垃圾指令长度</span></span><br><span class="line">        <span class="keyword">auto</span> TrushCodeLength_1 = CallAddr - (StartAddr + <span class="number">13</span> + CodeLength);</span><br><span class="line">        <span class="comment">// 第二部分垃圾指令长度</span></span><br><span class="line">        <span class="keyword">auto</span> TrushCodeLength_2 = JmpRaxAddr - CallAddr + <span class="number">2</span>;</span><br><span class="line">        <span class="comment">// Nop掉无用的所有代码</span></span><br><span class="line">        <span class="built_in">NopCode</span>(CallAddr, TrushCodeLength_2);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">NopCode</span>(StartAddr, <span class="number">13</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">NopCode</span>(StartAddr + <span class="number">13</span> + CodeLength, TrushCodeLength_1);</span><br><span class="line">        <span class="comment">// 一共两种地址计算，加和减</span></span><br><span class="line">        <span class="keyword">if</span> (Mode == <span class="number">0xffC32B48</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            CalcAddr = CalcAddr - ebx;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Mode == <span class="number">0xffC30348</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            CalcAddr = CalcAddr + ebx;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">auto</span> JmpCodeAddr = EndAddr;</span><br><span class="line">        <span class="comment">// 计算相对跳转地址</span></span><br><span class="line">        <span class="keyword">auto</span> JmpOffset = CalcAddr - JmpCodeAddr + <span class="number">5</span>;</span><br><span class="line">        <span class="comment">// 写入jmp指令</span></span><br><span class="line">        <span class="built_in">PatchByte</span>(JmpCodeAddr, <span class="number">0xE9</span>);</span><br><span class="line">        <span class="built_in">PatchDword</span>(JmpCodeAddr + <span class="number">1</span>, JmpOffset);</span><br><span class="line">        <span class="comment">// jmp的地址为下一次deobf起始地址</span></span><br><span class="line">        StartAddr = CalcAddr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行完，把main_0剩余代码都手动nop即可。</p>
<p><img src="/2025/04/07/XYCTF2025/44.png"></p>
<p>然后Apply patches to input file，应用一下patch，重新打开ida载入程序分析。</p>
<p>从main_0的jmp进入两层到这边，然后用IDA Delete Function删除sub_1401F7B77函数，然后对jmp那边按E即可重新重构完main函数（如图2），F5即可分析。</p>
<p><img src="/2025/04/07/XYCTF2025/45.png"></p>
<p><img src="/2025/04/07/XYCTF2025/46.png"></p>
<p>Main函数原代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">main_0</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rbp</span></span><br><span class="line">  __int64 v4; <span class="comment">// rdi</span></span><br><span class="line">  __int64 i; <span class="comment">// rcx</span></span><br><span class="line">  _DWORD *v7; <span class="comment">// rdi</span></span><br><span class="line">  HANDLE CurrentProcess; <span class="comment">// rax</span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp-20h] [rbp-458h] BYREF</span></span><br><span class="line">  _DWORD v10[<span class="number">2</span>]; <span class="comment">// [rsp+0h] [rbp-438h] BYREF</span></span><br><span class="line">  _BYTE v11[<span class="number">64</span>]; <span class="comment">// [rsp+8h] [rbp-430h] BYREF</span></span><br><span class="line">  _BYTE *v12; <span class="comment">// [rsp+48h] [rbp-3F0h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v13; <span class="comment">// [rsp+64h] [rbp-3D4h]</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [rsp+84h] [rbp-3B4h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v15; <span class="comment">// [rsp+A4h] [rbp-394h]</span></span><br><span class="line">  <span class="type">int</span> v16; <span class="comment">// [rsp+C4h] [rbp-374h]</span></span><br><span class="line">  <span class="type">int</span> v17; <span class="comment">// [rsp+E4h] [rbp-354h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> k; <span class="comment">// [rsp+104h] [rbp-334h]</span></span><br><span class="line">  <span class="type">int</span> v19; <span class="comment">// [rsp+124h] [rbp-314h]</span></span><br><span class="line">  <span class="type">int</span> v20; <span class="comment">// [rsp+144h] [rbp-2F4h]</span></span><br><span class="line">  <span class="type">int</span> v21; <span class="comment">// [rsp+164h] [rbp-2D4h]</span></span><br><span class="line">  _DWORD v22[<span class="number">11</span>]; <span class="comment">// [rsp+188h] [rbp-2B0h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int16 v23; <span class="comment">// [rsp+1B4h] [rbp-284h]</span></span><br><span class="line">  BOOL v24; <span class="comment">// [rsp+1D4h] [rbp-264h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 j; <span class="comment">// [rsp+1F8h] [rbp-240h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v26; <span class="comment">// [rsp+218h] [rbp-220h]</span></span><br><span class="line">  _DWORD v27[<span class="number">12</span>]; <span class="comment">// [rsp+238h] [rbp-200h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 m; <span class="comment">// [rsp+268h] [rbp-1D0h]</span></span><br><span class="line">  <span class="type">int</span> v29; <span class="comment">// [rsp+3F4h] [rbp-44h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v30; <span class="comment">// [rsp+3F8h] [rbp-40h]</span></span><br><span class="line">  <span class="type">int</span> v31; <span class="comment">// [rsp+3FCh] [rbp-3Ch]</span></span><br><span class="line">  __int64 v32; <span class="comment">// [rsp+400h] [rbp-38h]</span></span><br><span class="line">  <span class="type">int</span> v33; <span class="comment">// [rsp+408h] [rbp-30h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v34; <span class="comment">// [rsp+410h] [rbp-28h]</span></span><br><span class="line">  __int64 v35; <span class="comment">// [rsp+428h] [rbp-10h]</span></span><br><span class="line">  __int64 v36; <span class="comment">// [rsp+430h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v36 = v3;</span><br><span class="line">  v35 = v4;</span><br><span class="line">  v7 = v10;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">170</span>; i; --i )</span><br><span class="line">    *v7++ = <span class="number">-858993460</span>;</span><br><span class="line">  v34 = (<span class="type">unsigned</span> __int64)v10 ^ <span class="number">0x1401D9000LL</span>;</span><br><span class="line">  <span class="built_in">j___CheckForDebuggerJustMyCode</span>(<span class="number">0x1401ED104LL</span>);</span><br><span class="line">  <span class="built_in">memset</span>(v11, <span class="number">0</span>, <span class="number">0x20u</span>);</span><br><span class="line">  <span class="built_in">sub_140087C02</span>(<span class="number">0x1401A1190LL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">IsDebuggerPresent</span>() )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">sub_1400868E3</span>();</span><br><span class="line">    v12 = v11;</span><br><span class="line">    <span class="built_in">memset</span>(v22, <span class="number">0</span>, <span class="number">0x10u</span>);</span><br><span class="line">    v23 = <span class="number">8</span>;</span><br><span class="line">    v29 = <span class="number">8</span>;</span><br><span class="line">    v20 = <span class="number">12</span>;</span><br><span class="line">    v15 = <span class="number">0</span>;</span><br><span class="line">    v16 = <span class="number">0x61C88646</span>;</span><br><span class="line">    v21 = <span class="number">0x95664B48</span>;</span><br><span class="line">    v19 = <span class="number">7</span>;</span><br><span class="line">    v24 = <span class="number">0</span>;</span><br><span class="line">    CurrentProcess = <span class="built_in">GetCurrentProcess</span>();</span><br><span class="line">    <span class="built_in">CheckRemoteDebuggerPresent</span>(CurrentProcess, &amp;v24);</span><br><span class="line">    <span class="keyword">if</span> ( !v24 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">j_srand</span>(<span class="number">0xAABBu</span>);</span><br><span class="line">      <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j )</span><br><span class="line">        v22[j] = <span class="built_in">j_rand</span>();</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v29 = v19--;</span><br><span class="line">        v30 = v29 != <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> ( !v30 )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        v15 += v16;</span><br><span class="line">        v17 = (v15 &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; v23; ++k )</span><br><span class="line">        &#123;</span><br><span class="line">          v26 = __rdtsc();</span><br><span class="line">          v13 = *(_DWORD *)&amp;v12[<span class="number">4</span> * ((k + <span class="number">1</span>) % v23)];</span><br><span class="line">          v29 = (<span class="number">4</span> * v13) ^ (*(_DWORD *)&amp;v12[<span class="number">4</span> * ((k + v23 - <span class="number">1</span>) % v23)] &gt;&gt; <span class="number">5</span>);</span><br><span class="line">          v30 = k + v23 - <span class="number">1</span>;</span><br><span class="line">          v31 = ((<span class="number">16</span> * *(_DWORD *)&amp;v12[<span class="number">4</span> * (v30 % v23)]) ^ (v13 &gt;&gt; <span class="number">3</span>)) + v29;</span><br><span class="line">          v32 = ((<span class="type">unsigned</span> __int8)v17 ^ (<span class="type">unsigned</span> __int8)k) &amp; <span class="number">3</span>;</span><br><span class="line">          v33 = (((*(_DWORD *)&amp;v12[<span class="number">4</span> * (v30 % v23)] ^ v22[v32]) + (v13 ^ v15)) ^ v31) + *(_DWORD *)&amp;v12[<span class="number">4</span> * k];</span><br><span class="line">          *(_DWORD *)&amp;v12[<span class="number">4</span> * k] = v33;</span><br><span class="line">          v14 = v33;</span><br><span class="line">          <span class="keyword">if</span> ( __rdtsc() - v26 &gt; <span class="number">0x83C0</span> )</span><br><span class="line">            <span class="keyword">goto</span> LABEL_20;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      v27[<span class="number">0</span>] = <span class="number">0xA9934E2F</span>;</span><br><span class="line">      v27[<span class="number">1</span>] = <span class="number">0x30B90FA</span>;</span><br><span class="line">      v27[<span class="number">2</span>] = <span class="number">0xDCBF1D3</span>;</span><br><span class="line">      v27[<span class="number">3</span>] = <span class="number">0x328B5BDE</span>;</span><br><span class="line">      <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt; <span class="number">4</span>; ++m )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v27[m] != v10[m + <span class="number">2</span>] )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">sub_140087C02</span>(<span class="number">0x1401A11A8LL</span>);</span><br><span class="line">          <span class="built_in">j_system</span>(byte_1401A11A0);</span><br><span class="line">          <span class="keyword">goto</span> LABEL_20;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">sub_140087C02</span>(<span class="number">0x1401A11C0LL</span>);</span><br><span class="line">      <span class="built_in">j_system</span>(byte_1401A11A0);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">LABEL_20:</span><br><span class="line">  <span class="built_in">j__RTC_CheckStackVars</span>(&amp;v9, (_RTC_framedesc *)&amp;unk_1401A1140);</span><br><span class="line">  <span class="built_in">j___security_check_cookie</span>((<span class="type">unsigned</span> __int64)v10 ^ v34);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">sub_1401F8E9B</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>很清晰看出来是XXTEA加密，密钥是固定种子随机数随机得到的，Delta被魔改，然后密文也能看到。</p>
<p><strong>注：写WP时用的是旧版附件分析，缺失了后面16字节密文</strong></p>
<p>完整密文数据：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0xa9934e2f</span>, <span class="number">0x30b90fa</span>, <span class="number">0xdcbf1d3</span>, <span class="number">0x328b5bde</span>,</span><br><span class="line"><span class="number">0x44fab4e</span>, <span class="number">0x1dcf0051</span>, <span class="number">0x85ebbe55</span>, <span class="number">0x93aa773a</span></span><br></pre></td></tr></table></figure>

<p>解密代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DELTA 0x61C88646</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MX (((z &gt;&gt; 5 ^ y <span class="string">&lt;&lt; 2) + (y &gt;</span>&gt; 3 ^ z &lt;&lt; 4)) ^ ((sum ^ y) + (key[(p &amp; 3) ^ e] ^ z)))</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">xxtea</span><span class="params">(<span class="type">uint32_t</span> *v, <span class="type">int</span> n, <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> y, z, sum;</span><br><span class="line">    <span class="type">unsigned</span> p, rounds, e;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>) <span class="comment">/* Coding Part */</span></span><br><span class="line">    &#123;</span><br><span class="line">        rounds = <span class="number">7</span>;</span><br><span class="line">        sum = <span class="number">0</span>;</span><br><span class="line">        z = v[n - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            sum += DELTA;</span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p = <span class="number">0</span>; p &lt; n - <span class="number">1</span>; p++)</span><br><span class="line">            &#123;</span><br><span class="line">                y = v[p + <span class="number">1</span>];</span><br><span class="line">                z = v[p] += MX;</span><br><span class="line">                <span class="keyword">if</span> (z == <span class="number">0xA4F41487</span>)</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;11\n&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span> (y == <span class="number">0xA4F41487</span>)</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;11\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            y = v[<span class="number">0</span>];</span><br><span class="line">            z = v[n - <span class="number">1</span>] += MX;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (n &lt; <span class="number">-1</span>) <span class="comment">/* Decoding Part */</span></span><br><span class="line">    &#123;</span><br><span class="line">        n = -n;</span><br><span class="line">        rounds = <span class="number">7</span>;</span><br><span class="line">        sum = rounds * DELTA;</span><br><span class="line">        y = v[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p = n - <span class="number">1</span>; p &gt; <span class="number">0</span>; p--)</span><br><span class="line">            &#123;</span><br><span class="line">                z = v[p - <span class="number">1</span>];</span><br><span class="line">                y = v[p] -= MX;</span><br><span class="line">            &#125;</span><br><span class="line">            z = v[n - <span class="number">1</span>];</span><br><span class="line">            y = v[<span class="number">0</span>] -= MX;</span><br><span class="line">            sum -= DELTA;</span><br><span class="line">        &#125; <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">srand</span>(<span class="number">0xAABB</span>);</span><br><span class="line">    <span class="type">uint32_t</span> key[<span class="number">4</span>]&#123;&#125;;</span><br><span class="line">    <span class="type">uint32_t</span> Enc[]&#123;</span><br><span class="line">        <span class="number">0xa9934e2f</span>, <span class="number">0x30b90fa</span>, <span class="number">0xdcbf1d3</span>, <span class="number">0x328b5bde</span>,</span><br><span class="line">        <span class="number">0x44fab4e</span>, <span class="number">0x1dcf0051</span>, <span class="number">0x85ebbe55</span>, <span class="number">0x93aa773a</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        key[i] = <span class="built_in">rand</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">xxtea</span>(Enc, <span class="number">-8</span>, key);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.32s\n&quot;</span>, Enc);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>flag{th15_15_51mpLe_obf_R19Ht?}</p>
<h2 id="CrackMe"><a href="#CrackMe" class="headerlink" title="CrackMe"></a>CrackMe</h2><p>有反调试，在WinMain开头断点，使用ScyllaHide一把梭去除（（。</p>
<p><img src="/2025/04/07/XYCTF2025/47.png"></p>
<p><img src="/2025/04/07/XYCTF2025/48.png"></p>
<p>从WinMain可以跟踪到窗口消息函数，图四就是验证函数按钮消息。</p>
<p><img src="/2025/04/07/XYCTF2025/49.png"></p>
<p><img src="/2025/04/07/XYCTF2025/50.png"></p>
<p><img src="/2025/04/07/XYCTF2025/51.png"></p>
<p><img src="/2025/04/07/XYCTF2025/52.png"></p>
<p>从TLS那边可以看到启动了一个线程，线程函数如下</p>
<p><img src="/2025/04/07/XYCTF2025/53.png"></p>
<p>这边死循环判断了一个值，然后调用CallBack，随便输入flag，点击验证，发现会先调用CallBack中的mark2函数进行第一次验证。</p>
<p><img src="/2025/04/07/XYCTF2025/54.png"></p>
<p>将这边v4都异或上0xBB会得到”flag{“五个字符，就明白这边是检测输入flag开头是否为”flag{“，进行了第一次验证，然后继续下一次验证进入了case 5的mark3函数。</p>
<p><img src="/2025/04/07/XYCTF2025/55.png"></p>
<p>mark3这边是用固定值生成了一个v5数值列表，a1是输入的字符串，但是可以看到+5跳过了前面的五个字符，然后对括号内的前7个字符做一些加密计算然后和v5列表前7个数值进行检验。</p>
<p>这边就可以直接提取v5生成的数值列表，然后利用爆破得到括号内的前七个字符。</p>
<p><img src="/2025/04/07/XYCTF2025/56.png"></p>
<p>爆破代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">int</span> box1[] = &#123;</span><br><span class="line">      <span class="number">0x00000000</span>, <span class="number">0xC0BA6CAC</span>, <span class="number">0x5A05DF1B</span>, <span class="number">0x9ABFB3B7</span>, <span class="number">0xB40BBE36</span>, <span class="number">0x74B1D29A</span>,</span><br><span class="line">      <span class="number">0xEE0E612D</span>, <span class="number">0x2EB40D81</span>, <span class="number">0xB3667A2F</span>, <span class="number">0x73DC1683</span>, <span class="number">0xE963A534</span>, <span class="number">0x29D9C998</span>, <span class="number">0x076DC419</span>, <span class="number">0xC7D7A8B5</span>,</span><br><span class="line">      <span class="number">0x5D681B02</span>, <span class="number">0x9DD277AE</span>, <span class="number">0xBDBDF21D</span>, <span class="number">0x7D079EB1</span>, <span class="number">0xE7B82D06</span>, <span class="number">0x270241AA</span>, <span class="number">0x09B64C2B</span>, <span class="number">0xC90C2087</span>,</span><br><span class="line">      <span class="number">0x53B39330</span>, <span class="number">0x9309FF9C</span>, <span class="number">0x0EDB8832</span>, <span class="number">0xCE61E49E</span>, <span class="number">0x54DE5729</span>, <span class="number">0x94643B85</span>, <span class="number">0xBAD03604</span>, <span class="number">0x7A6A5AA8</span>,</span><br><span class="line">      <span class="number">0xE0D5E91F</span>, <span class="number">0x206F85B3</span>, <span class="number">0xA00AE279</span>, <span class="number">0x60B08ED5</span>, <span class="number">0xFA0F3D62</span>, <span class="number">0x3AB551CE</span>, <span class="number">0x14015C4F</span>, <span class="number">0xD4BB30E3</span>,</span><br><span class="line">      <span class="number">0x4E048354</span>, <span class="number">0x8EBEEFF8</span>, <span class="number">0x136C9856</span>, <span class="number">0xD3D6F4FA</span>, <span class="number">0x4969474D</span>, <span class="number">0x89D32BE1</span>, <span class="number">0xA7672660</span>, <span class="number">0x67DD4ACC</span>,</span><br><span class="line">      <span class="number">0xFD62F97B</span>, <span class="number">0x3DD895D7</span>, <span class="number">0x1DB71064</span>, <span class="number">0xDD0D7CC8</span>, <span class="number">0x47B2CF7F</span>, <span class="number">0x8708A3D3</span>, <span class="number">0xA9BCAE52</span>, <span class="number">0x6906C2FE</span>,</span><br><span class="line">      <span class="number">0xF3B97149</span>, <span class="number">0x33031DE5</span>, <span class="number">0xAED16A4B</span>, <span class="number">0x6E6B06E7</span>, <span class="number">0xF4D4B550</span>, <span class="number">0x346ED9FC</span>, <span class="number">0x1ADAD47D</span>, <span class="number">0xDA60B8D1</span>,</span><br><span class="line">      <span class="number">0x40DF0B66</span>, <span class="number">0x806567CA</span>, <span class="number">0x9B64C2B1</span>, <span class="number">0x5BDEAE1D</span>, <span class="number">0xC1611DAA</span>, <span class="number">0x01DB7106</span>, <span class="number">0x2F6F7C87</span>, <span class="number">0xEFD5102B</span>,</span><br><span class="line">      <span class="number">0x756AA39C</span>, <span class="number">0xB5D0CF30</span>, <span class="number">0x2802B89E</span>, <span class="number">0xE8B8D432</span>, <span class="number">0x72076785</span>, <span class="number">0xB2BD0B29</span>, <span class="number">0x9C0906A8</span>, <span class="number">0x5CB36A04</span>,</span><br><span class="line">      <span class="number">0xC60CD9B3</span>, <span class="number">0x06B6B51F</span>, <span class="number">0x26D930AC</span>, <span class="number">0xE6635C00</span>, <span class="number">0x7CDCEFB7</span>, <span class="number">0xBC66831B</span>, <span class="number">0x92D28E9A</span>, <span class="number">0x5268E236</span>,</span><br><span class="line">      <span class="number">0xC8D75181</span>, <span class="number">0x086D3D2D</span>, <span class="number">0x95BF4A83</span>, <span class="number">0x5505262F</span>, <span class="number">0xCFBA9598</span>, <span class="number">0x0F00F934</span>, <span class="number">0x21B4F4B5</span>, <span class="number">0xE10E9819</span>,</span><br><span class="line">      <span class="number">0x7BB12BAE</span>, <span class="number">0xBB0B4702</span>, <span class="number">0x3B6E20C8</span>, <span class="number">0xFBD44C64</span>, <span class="number">0x616BFFD3</span>, <span class="number">0xA1D1937F</span>, <span class="number">0x8F659EFE</span>, <span class="number">0x4FDFF252</span>,</span><br><span class="line">      <span class="number">0xD56041E5</span>, <span class="number">0x15DA2D49</span>, <span class="number">0x88085AE7</span>, <span class="number">0x48B2364B</span>, <span class="number">0xD20D85FC</span>, <span class="number">0x12B7E950</span>, <span class="number">0x3C03E4D1</span>, <span class="number">0xFCB9887D</span>,</span><br><span class="line">      <span class="number">0x66063BCA</span>, <span class="number">0xA6BC5766</span>, <span class="number">0x86D3D2D5</span>, <span class="number">0x4669BE79</span>, <span class="number">0xDCD60DCE</span>, <span class="number">0x1C6C6162</span>, <span class="number">0x32D86CE3</span>, <span class="number">0xF262004F</span>,</span><br><span class="line">      <span class="number">0x68DDB3F8</span>, <span class="number">0xA867DF54</span>, <span class="number">0x35B5A8FA</span>, <span class="number">0xF50FC456</span>, <span class="number">0x6FB077E1</span>, <span class="number">0xAF0A1B4D</span>, <span class="number">0x81BE16CC</span>, <span class="number">0x41047A60</span>,</span><br><span class="line">      <span class="number">0xDBBBC9D7</span>, <span class="number">0x1B01A57B</span>, <span class="number">0xEDB88321</span>, <span class="number">0x2D02EF8D</span>, <span class="number">0xB7BD5C3A</span>, <span class="number">0x77073096</span>, <span class="number">0x59B33D17</span>, <span class="number">0x990951BB</span>,</span><br><span class="line">      <span class="number">0x03B6E20C</span>, <span class="number">0xC30C8EA0</span>, <span class="number">0x5EDEF90E</span>, <span class="number">0x9E6495A2</span>, <span class="number">0x04DB2615</span>, <span class="number">0xC4614AB9</span>, <span class="number">0xEAD54738</span>, <span class="number">0x2A6F2B94</span>,</span><br><span class="line">      <span class="number">0xB0D09823</span>, <span class="number">0x706AF48F</span>, <span class="number">0x5005713C</span>, <span class="number">0x90BF1D90</span>, <span class="number">0x0A00AE27</span>, <span class="number">0xCABAC28B</span>, <span class="number">0xE40ECF0A</span>, <span class="number">0x24B4A3A6</span>,</span><br><span class="line">      <span class="number">0xBE0B1011</span>, <span class="number">0x7EB17CBD</span>, <span class="number">0xE3630B13</span>, <span class="number">0x23D967BF</span>, <span class="number">0xB966D408</span>, <span class="number">0x79DCB8A4</span>, <span class="number">0x5768B525</span>, <span class="number">0x97D2D989</span>,</span><br><span class="line">      <span class="number">0x0D6D6A3E</span>, <span class="number">0xCDD70692</span>, <span class="number">0x4DB26158</span>, <span class="number">0x8D080DF4</span>, <span class="number">0x17B7BE43</span>, <span class="number">0xD70DD2EF</span>, <span class="number">0xF9B9DF6E</span>, <span class="number">0x3903B3C2</span>,</span><br><span class="line">      <span class="number">0xA3BC0075</span>, <span class="number">0x63066CD9</span>, <span class="number">0xFED41B77</span>, <span class="number">0x3E6E77DB</span>, <span class="number">0xA4D1C46C</span>, <span class="number">0x646BA8C0</span>, <span class="number">0x4ADFA541</span>, <span class="number">0x8A65C9ED</span>,</span><br><span class="line">      <span class="number">0x10DA7A5A</span>, <span class="number">0xD06016F6</span>, <span class="number">0xF00F9345</span>, <span class="number">0x30B5FFE9</span>, <span class="number">0xAA0A4C5E</span>, <span class="number">0x6AB020F2</span>, <span class="number">0x44042D73</span>, <span class="number">0x84BE41DF</span>,</span><br><span class="line">      <span class="number">0x1E01F268</span>, <span class="number">0xDEBB9EC4</span>, <span class="number">0x4369E96A</span>, <span class="number">0x83D385C6</span>, <span class="number">0x196C3671</span>, <span class="number">0xD9D65ADD</span>, <span class="number">0xF762575C</span>, <span class="number">0x37D83BF0</span>,</span><br><span class="line">      <span class="number">0xAD678847</span>, <span class="number">0x6DDDE4EB</span>, <span class="number">0x76DC4190</span>, <span class="number">0xB6662D3C</span>, <span class="number">0x2CD99E8B</span>, <span class="number">0xEC63F227</span>, <span class="number">0xC2D7FFA6</span>, <span class="number">0x026D930A</span>,</span><br><span class="line">      <span class="number">0x98D220BD</span>, <span class="number">0x58684C11</span>, <span class="number">0xC5BA3BBF</span>, <span class="number">0x05005713</span>, <span class="number">0x9FBFE4A4</span>, <span class="number">0x5F058808</span>, <span class="number">0x71B18589</span>, <span class="number">0xB10BE925</span>,</span><br><span class="line">      <span class="number">0x2BB45A92</span>, <span class="number">0xEB0E363E</span>, <span class="number">0xCB61B38D</span>, <span class="number">0x0BDBDF21</span>, <span class="number">0x91646C96</span>, <span class="number">0x51DE003A</span>, <span class="number">0x7F6A0DBB</span>, <span class="number">0xBFD06117</span>,</span><br><span class="line">      <span class="number">0x256FD2A0</span>, <span class="number">0xE5D5BE0C</span>, <span class="number">0x7807C9A2</span>, <span class="number">0xB8BDA50E</span>, <span class="number">0x220216B9</span>, <span class="number">0xE2B87A15</span>, <span class="number">0xCC0C7794</span>, <span class="number">0x0CB61B38</span>,</span><br><span class="line">      <span class="number">0x9609A88F</span>, <span class="number">0x56B3C423</span>, <span class="number">0xD6D6A3E9</span>, <span class="number">0x166CCF45</span>, <span class="number">0x8CD37CF2</span>, <span class="number">0x4C69105E</span>, <span class="number">0x62DD1DDF</span>, <span class="number">0xA2677173</span>,</span><br><span class="line">      <span class="number">0x38D8C2C4</span>, <span class="number">0xF862AE68</span>, <span class="number">0x65B0D9C6</span>, <span class="number">0xA50AB56A</span>, <span class="number">0x3FB506DD</span>, <span class="number">0xFF0F6A71</span>, <span class="number">0xD1BB67F0</span>, <span class="number">0x11010B5C</span>,</span><br><span class="line">      <span class="number">0x8BBEB8EB</span>, <span class="number">0x4B04D447</span>, <span class="number">0x6B6B51F4</span>, <span class="number">0xABD13D58</span>, <span class="number">0x316E8EEF</span>, <span class="number">0xF1D4E243</span>, <span class="number">0xDF60EFC2</span>, <span class="number">0x1FDA836E</span>,</span><br><span class="line">      <span class="number">0x856530D9</span>, <span class="number">0x45DF5C75</span>, <span class="number">0xD80D2BDB</span>, <span class="number">0x18B74777</span>, <span class="number">0x8208F4C0</span>, <span class="number">0x42B2986C</span>, <span class="number">0x6C0695ED</span>, <span class="number">0xACBCF941</span>,</span><br><span class="line">      <span class="number">0x36034AF6</span>, <span class="number">0xF6B9265A</span>, <span class="number">0xCCCCCCCC</span>, <span class="number">0xCCCCCC00</span>, <span class="number">0x00000100</span>, <span class="number">0x00000000</span>, <span class="number">0xF6B9265A</span>, <span class="number">0xCCCCCCCC</span>,</span><br><span class="line">      <span class="number">0x00000008</span>, <span class="number">0x00000000</span>&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="type">uint32_t</span> enc1[]&#123;</span><br><span class="line">      <span class="number">0x46A95BAD</span>,</span><br><span class="line">      <span class="number">0x1CAC84B6</span>,</span><br><span class="line">      <span class="number">0xA67CB2B2</span>,</span><br><span class="line">      <span class="number">0x32188937</span>,</span><br><span class="line">      <span class="number">0x4872D39F</span>,</span><br><span class="line">      <span class="number">0xF2A2E59B</span>,</span><br><span class="line">      <span class="number">0x011B94D2</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 爆破前7字节</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">7</span>; i++)</span><br><span class="line">  &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> c = <span class="number">28</span>; c &lt; <span class="number">132</span>; c++)</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">if</span> ((~box1[(<span class="type">uint8_t</span>)c ^ <span class="number">0x79</span>] ^ <span class="number">0xB0E0E879</span>) == enc1[i])</span><br><span class="line">          &#123;</span><br><span class="line">              <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, c);</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>得到前七个字符为：<strong>moshui_</strong></p>
<p>第三次Check是在case 0处，程序起始的时候启了一个线程，死循环然后这边判断前两次Check是否成功，然后进入最后一次Check代码。</p>
<p><img src="/2025/04/07/XYCTF2025/57.png"></p>
<p><img src="/2025/04/07/XYCTF2025/58.png"></p>
<p>开始的时候利用前五个字节以及括号内前七个字节生成了两个四字节密钥，然后又赋值了另外两个固定的密钥值。</p>
<p>由于前五字节和括号内前七个字节是已知固定的，所以生成的密钥也是固定，可以直接提取计算完的密钥。</p>
<p>密钥：<strong>0x42B2986C, 0x12345678, 0x0D6D6A3E, 0x89ABCDEF</strong></p>
<p><img src="/2025/04/07/XYCTF2025/59.png"></p>
<p>然后下面赋值了密文到v7，判断输入的字符串第29个字符是否为’}’，这边可知flag长度为29，然后利用密钥和输入字符串，进行加密，最后和v7判断。</p>
<p><img src="/2025/04/07/XYCTF2025/60.png"></p>
<p>加密是8字节8字节加密，观察sub_7FF7ADAB1640可知是IDEA加密算法，循环加密0x10000次没什么用，因为Input和Output在两个不同数组，所以和加密一次是一样结果。</p>
<p>利用IDEA解密算法配合密钥解密v7的值即可得到后16字节，最后拼接得到完整flag。</p>
<p><img src="/2025/04/07/XYCTF2025/61.png"></p>
<p>解密代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bitset&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> bitset&lt;16&gt; code;</span><br><span class="line"><span class="keyword">typedef</span> bitset&lt;128&gt; key;</span><br><span class="line"></span><br><span class="line">bitset&lt;16&gt; sub_key[<span class="number">52</span>];</span><br><span class="line">bitset&lt;16&gt; inv_sub_key[<span class="number">52</span>];</span><br><span class="line"></span><br><span class="line"><span class="function">code <span class="title">XOR</span><span class="params">(code code_1, code code_2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> code_1 ^ code_2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">code <span class="title">Plus</span><span class="params">(code code_1, code code_2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> tmp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        tmp += code_1[i] * <span class="built_in">pow</span>(<span class="number">2</span>, i) + code_2[i] * <span class="built_in">pow</span>(<span class="number">2</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">    tmp %= <span class="number">65536</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bitset</span>&lt;<span class="number">16</span>&gt;(tmp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">code <span class="title">invPlus</span><span class="params">(code code_in)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> tmp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">        tmp += code_in[i] * <span class="built_in">pow</span>(<span class="number">2</span>, i);</span><br><span class="line">    tmp = <span class="number">65536</span> - tmp;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bitset</span>&lt;<span class="number">16</span>&gt;(tmp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">code <span class="title">Times</span><span class="params">(code code_1, code code_2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> tmp_1 = <span class="number">0</span>, tmp_2 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        tmp_1 += code_1[i] * <span class="built_in">pow</span>(<span class="number">2</span>, i);</span><br><span class="line">        tmp_2 += code_2[i] * <span class="built_in">pow</span>(<span class="number">2</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (tmp_1 == <span class="number">0</span>)</span><br><span class="line">        tmp_1 = <span class="number">65536</span>;</span><br><span class="line">    <span class="keyword">if</span> (tmp_2 == <span class="number">0</span>)</span><br><span class="line">        tmp_2 = <span class="number">65536</span>;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> tmp = (tmp_1 * tmp_2) % <span class="number">65537</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bitset</span>&lt;<span class="number">16</span>&gt;(tmp == <span class="number">65536</span> ? <span class="number">0</span> : tmp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Exgcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> &amp;x, <span class="type">int</span> &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!b)</span><br><span class="line">        x = <span class="number">1</span>, y = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">Exgcd</span>(b, a % b, y, x), y -= a / b * x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">code <span class="title">invTimes</span><span class="params">(code code_in)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> tmp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">        tmp += code_in[i] * <span class="built_in">pow</span>(<span class="number">2</span>, i);</span><br><span class="line">    <span class="type">int</span> x, y;</span><br><span class="line">    <span class="type">int</span> p = <span class="number">65537</span>;</span><br><span class="line">    <span class="built_in">Exgcd</span>(tmp, p, x, y);</span><br><span class="line">    x = (x % p + p) % p;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bitset</span>&lt;<span class="number">16</span>&gt;(x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">subkeys_get</span><span class="params">(code keys_input[<span class="number">8</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    key keys;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">16</span>; j++)</span><br><span class="line">            keys[j + <span class="number">16</span> * i] = keys_input[<span class="number">7</span> - i][j];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">16</span>; j++)</span><br><span class="line">            sub_key[i][<span class="number">15</span> - j] = keys[<span class="number">127</span> - (j + <span class="number">16</span> * i)];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        key tmp_keys = keys &gt;&gt; <span class="number">103</span>;</span><br><span class="line">        keys = (keys &lt;&lt; <span class="number">25</span>) | tmp_keys;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = (<span class="number">8</span> + <span class="number">8</span> * i); j &lt; (<span class="number">8</span> * (i + <span class="number">2</span>)); j++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; <span class="number">16</span>; k++)</span><br><span class="line">                sub_key[j][<span class="number">15</span> - k] = keys[<span class="number">127</span> - (k + <span class="number">16</span> * (j - <span class="number">8</span> - <span class="number">8</span> * i))];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    key tmp_keys = keys &gt;&gt; <span class="number">103</span>;</span><br><span class="line">    keys = (keys &lt;&lt; <span class="number">25</span>) | tmp_keys;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">48</span>; i &lt; <span class="number">52</span>; i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">16</span>; j++)</span><br><span class="line">            sub_key[i][<span class="number">15</span> - j] = keys[<span class="number">127</span> - (j + <span class="number">16</span> * (i - <span class="number">48</span>))];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">inv_subkeys_get</span><span class="params">(code sub_key[<span class="number">52</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">6</span>; i &lt; <span class="number">48</span>; i += <span class="number">6</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        inv_sub_key[i] = <span class="built_in">invTimes</span>(sub_key[<span class="number">48</span> - i]);</span><br><span class="line">        inv_sub_key[i + <span class="number">1</span>] = <span class="built_in">invPlus</span>(sub_key[<span class="number">50</span> - i]);</span><br><span class="line">        inv_sub_key[i + <span class="number">2</span>] = <span class="built_in">invPlus</span>(sub_key[<span class="number">49</span> - i]);</span><br><span class="line">        inv_sub_key[i + <span class="number">3</span>] = <span class="built_in">invTimes</span>(sub_key[<span class="number">51</span> - i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i += <span class="number">6</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        inv_sub_key[i + <span class="number">4</span>] = sub_key[<span class="number">46</span> - i];</span><br><span class="line">        inv_sub_key[i + <span class="number">5</span>] = sub_key[<span class="number">47</span> - i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    inv_sub_key[<span class="number">0</span>] = <span class="built_in">invTimes</span>(sub_key[<span class="number">48</span>]);</span><br><span class="line">    inv_sub_key[<span class="number">1</span>] = <span class="built_in">invPlus</span>(sub_key[<span class="number">49</span>]);</span><br><span class="line">    inv_sub_key[<span class="number">2</span>] = <span class="built_in">invPlus</span>(sub_key[<span class="number">50</span>]);</span><br><span class="line">    inv_sub_key[<span class="number">3</span>] = <span class="built_in">invTimes</span>(sub_key[<span class="number">51</span>]);</span><br><span class="line"></span><br><span class="line">    inv_sub_key[<span class="number">48</span>] = <span class="built_in">invTimes</span>(sub_key[<span class="number">0</span>]);</span><br><span class="line">    inv_sub_key[<span class="number">49</span>] = <span class="built_in">invPlus</span>(sub_key[<span class="number">1</span>]);</span><br><span class="line">    inv_sub_key[<span class="number">50</span>] = <span class="built_in">invPlus</span>(sub_key[<span class="number">2</span>]);</span><br><span class="line">    inv_sub_key[<span class="number">51</span>] = <span class="built_in">invTimes</span>(sub_key[<span class="number">3</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">bitset&lt;64&gt; <span class="title">dencrypt</span><span class="params">(bitset&lt;<span class="number">64</span>&gt; cipher)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    bitset&lt;16&gt; I_1, I_2, I_3, I_4;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        I_1[<span class="number">15</span> - i] = cipher[<span class="number">63</span> - i];</span><br><span class="line">        I_2[<span class="number">15</span> - i] = cipher[<span class="number">47</span> - i];</span><br><span class="line">        I_3[<span class="number">15</span> - i] = cipher[<span class="number">31</span> - i];</span><br><span class="line">        I_4[i] = cipher[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i += <span class="number">6</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        bitset&lt;16&gt; tmp_1 = <span class="built_in">Times</span>(inv_sub_key[i], I_1);</span><br><span class="line">        bitset&lt;16&gt; tmp_2 = <span class="built_in">Plus</span>(inv_sub_key[i + <span class="number">1</span>], I_2);</span><br><span class="line">        bitset&lt;16&gt; tmp_3 = <span class="built_in">Plus</span>(inv_sub_key[i + <span class="number">2</span>], I_3);</span><br><span class="line">        bitset&lt;16&gt; tmp_4 = <span class="built_in">Times</span>(inv_sub_key[i + <span class="number">3</span>], I_4);</span><br><span class="line">        bitset&lt;16&gt; tmp_5 = <span class="built_in">XOR</span>(tmp_1, tmp_3);</span><br><span class="line">        bitset&lt;16&gt; tmp_6 = <span class="built_in">XOR</span>(tmp_2, tmp_4);</span><br><span class="line">        bitset&lt;16&gt; tmp_7 = <span class="built_in">Times</span>(inv_sub_key[i + <span class="number">4</span>], tmp_5);</span><br><span class="line">        bitset&lt;16&gt; tmp_8 = <span class="built_in">Plus</span>(tmp_6, tmp_7);</span><br><span class="line">        bitset&lt;16&gt; tmp_9 = <span class="built_in">Times</span>(tmp_8, inv_sub_key[i + <span class="number">5</span>]);</span><br><span class="line">        bitset&lt;16&gt; tmp_10 = <span class="built_in">Plus</span>(tmp_7, tmp_9);</span><br><span class="line">        I_1 = <span class="built_in">XOR</span>(tmp_1, tmp_9);</span><br><span class="line">        I_2 = <span class="built_in">XOR</span>(tmp_3, tmp_9);</span><br><span class="line">        I_3 = <span class="built_in">XOR</span>(tmp_2, tmp_10);</span><br><span class="line">        I_4 = <span class="built_in">XOR</span>(tmp_4, tmp_10);</span><br><span class="line">    &#125;</span><br><span class="line">    bitset&lt;16&gt; Y_1 = <span class="built_in">Times</span>(I_1, inv_sub_key[<span class="number">48</span>]);</span><br><span class="line">    bitset&lt;16&gt; Y_2 = <span class="built_in">Plus</span>(I_3, inv_sub_key[<span class="number">49</span>]);</span><br><span class="line">    bitset&lt;16&gt; Y_3 = <span class="built_in">Plus</span>(I_2, inv_sub_key[<span class="number">50</span>]);</span><br><span class="line">    bitset&lt;16&gt; Y_4 = <span class="built_in">Times</span>(I_4, inv_sub_key[<span class="number">51</span>]);</span><br><span class="line"></span><br><span class="line">    bitset&lt;64&gt; plaint;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        plaint[i] = Y_4[i];</span><br><span class="line">        plaint[i + <span class="number">16</span>] = Y_3[i];</span><br><span class="line">        plaint[i + <span class="number">32</span>] = Y_2[i];</span><br><span class="line">        plaint[i + <span class="number">48</span>] = Y_1[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> plaint;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> box1[] = &#123;</span><br><span class="line">        <span class="number">0x00000000</span>, <span class="number">0xC0BA6CAC</span>, <span class="number">0x5A05DF1B</span>, <span class="number">0x9ABFB3B7</span>, <span class="number">0xB40BBE36</span>, <span class="number">0x74B1D29A</span>,</span><br><span class="line">        <span class="number">0xEE0E612D</span>, <span class="number">0x2EB40D81</span>, <span class="number">0xB3667A2F</span>, <span class="number">0x73DC1683</span>, <span class="number">0xE963A534</span>, <span class="number">0x29D9C998</span>, <span class="number">0x076DC419</span>, <span class="number">0xC7D7A8B5</span>,</span><br><span class="line">        <span class="number">0x5D681B02</span>, <span class="number">0x9DD277AE</span>, <span class="number">0xBDBDF21D</span>, <span class="number">0x7D079EB1</span>, <span class="number">0xE7B82D06</span>, <span class="number">0x270241AA</span>, <span class="number">0x09B64C2B</span>, <span class="number">0xC90C2087</span>,</span><br><span class="line">        <span class="number">0x53B39330</span>, <span class="number">0x9309FF9C</span>, <span class="number">0x0EDB8832</span>, <span class="number">0xCE61E49E</span>, <span class="number">0x54DE5729</span>, <span class="number">0x94643B85</span>, <span class="number">0xBAD03604</span>, <span class="number">0x7A6A5AA8</span>,</span><br><span class="line">        <span class="number">0xE0D5E91F</span>, <span class="number">0x206F85B3</span>, <span class="number">0xA00AE279</span>, <span class="number">0x60B08ED5</span>, <span class="number">0xFA0F3D62</span>, <span class="number">0x3AB551CE</span>, <span class="number">0x14015C4F</span>, <span class="number">0xD4BB30E3</span>,</span><br><span class="line">        <span class="number">0x4E048354</span>, <span class="number">0x8EBEEFF8</span>, <span class="number">0x136C9856</span>, <span class="number">0xD3D6F4FA</span>, <span class="number">0x4969474D</span>, <span class="number">0x89D32BE1</span>, <span class="number">0xA7672660</span>, <span class="number">0x67DD4ACC</span>,</span><br><span class="line">        <span class="number">0xFD62F97B</span>, <span class="number">0x3DD895D7</span>, <span class="number">0x1DB71064</span>, <span class="number">0xDD0D7CC8</span>, <span class="number">0x47B2CF7F</span>, <span class="number">0x8708A3D3</span>, <span class="number">0xA9BCAE52</span>, <span class="number">0x6906C2FE</span>,</span><br><span class="line">        <span class="number">0xF3B97149</span>, <span class="number">0x33031DE5</span>, <span class="number">0xAED16A4B</span>, <span class="number">0x6E6B06E7</span>, <span class="number">0xF4D4B550</span>, <span class="number">0x346ED9FC</span>, <span class="number">0x1ADAD47D</span>, <span class="number">0xDA60B8D1</span>,</span><br><span class="line">        <span class="number">0x40DF0B66</span>, <span class="number">0x806567CA</span>, <span class="number">0x9B64C2B1</span>, <span class="number">0x5BDEAE1D</span>, <span class="number">0xC1611DAA</span>, <span class="number">0x01DB7106</span>, <span class="number">0x2F6F7C87</span>, <span class="number">0xEFD5102B</span>,</span><br><span class="line">        <span class="number">0x756AA39C</span>, <span class="number">0xB5D0CF30</span>, <span class="number">0x2802B89E</span>, <span class="number">0xE8B8D432</span>, <span class="number">0x72076785</span>, <span class="number">0xB2BD0B29</span>, <span class="number">0x9C0906A8</span>, <span class="number">0x5CB36A04</span>,</span><br><span class="line">        <span class="number">0xC60CD9B3</span>, <span class="number">0x06B6B51F</span>, <span class="number">0x26D930AC</span>, <span class="number">0xE6635C00</span>, <span class="number">0x7CDCEFB7</span>, <span class="number">0xBC66831B</span>, <span class="number">0x92D28E9A</span>, <span class="number">0x5268E236</span>,</span><br><span class="line">        <span class="number">0xC8D75181</span>, <span class="number">0x086D3D2D</span>, <span class="number">0x95BF4A83</span>, <span class="number">0x5505262F</span>, <span class="number">0xCFBA9598</span>, <span class="number">0x0F00F934</span>, <span class="number">0x21B4F4B5</span>, <span class="number">0xE10E9819</span>,</span><br><span class="line">        <span class="number">0x7BB12BAE</span>, <span class="number">0xBB0B4702</span>, <span class="number">0x3B6E20C8</span>, <span class="number">0xFBD44C64</span>, <span class="number">0x616BFFD3</span>, <span class="number">0xA1D1937F</span>, <span class="number">0x8F659EFE</span>, <span class="number">0x4FDFF252</span>,</span><br><span class="line">        <span class="number">0xD56041E5</span>, <span class="number">0x15DA2D49</span>, <span class="number">0x88085AE7</span>, <span class="number">0x48B2364B</span>, <span class="number">0xD20D85FC</span>, <span class="number">0x12B7E950</span>, <span class="number">0x3C03E4D1</span>, <span class="number">0xFCB9887D</span>,</span><br><span class="line">        <span class="number">0x66063BCA</span>, <span class="number">0xA6BC5766</span>, <span class="number">0x86D3D2D5</span>, <span class="number">0x4669BE79</span>, <span class="number">0xDCD60DCE</span>, <span class="number">0x1C6C6162</span>, <span class="number">0x32D86CE3</span>, <span class="number">0xF262004F</span>,</span><br><span class="line">        <span class="number">0x68DDB3F8</span>, <span class="number">0xA867DF54</span>, <span class="number">0x35B5A8FA</span>, <span class="number">0xF50FC456</span>, <span class="number">0x6FB077E1</span>, <span class="number">0xAF0A1B4D</span>, <span class="number">0x81BE16CC</span>, <span class="number">0x41047A60</span>,</span><br><span class="line">        <span class="number">0xDBBBC9D7</span>, <span class="number">0x1B01A57B</span>, <span class="number">0xEDB88321</span>, <span class="number">0x2D02EF8D</span>, <span class="number">0xB7BD5C3A</span>, <span class="number">0x77073096</span>, <span class="number">0x59B33D17</span>, <span class="number">0x990951BB</span>,</span><br><span class="line">        <span class="number">0x03B6E20C</span>, <span class="number">0xC30C8EA0</span>, <span class="number">0x5EDEF90E</span>, <span class="number">0x9E6495A2</span>, <span class="number">0x04DB2615</span>, <span class="number">0xC4614AB9</span>, <span class="number">0xEAD54738</span>, <span class="number">0x2A6F2B94</span>,</span><br><span class="line">        <span class="number">0xB0D09823</span>, <span class="number">0x706AF48F</span>, <span class="number">0x5005713C</span>, <span class="number">0x90BF1D90</span>, <span class="number">0x0A00AE27</span>, <span class="number">0xCABAC28B</span>, <span class="number">0xE40ECF0A</span>, <span class="number">0x24B4A3A6</span>,</span><br><span class="line">        <span class="number">0xBE0B1011</span>, <span class="number">0x7EB17CBD</span>, <span class="number">0xE3630B13</span>, <span class="number">0x23D967BF</span>, <span class="number">0xB966D408</span>, <span class="number">0x79DCB8A4</span>, <span class="number">0x5768B525</span>, <span class="number">0x97D2D989</span>,</span><br><span class="line">        <span class="number">0x0D6D6A3E</span>, <span class="number">0xCDD70692</span>, <span class="number">0x4DB26158</span>, <span class="number">0x8D080DF4</span>, <span class="number">0x17B7BE43</span>, <span class="number">0xD70DD2EF</span>, <span class="number">0xF9B9DF6E</span>, <span class="number">0x3903B3C2</span>,</span><br><span class="line">        <span class="number">0xA3BC0075</span>, <span class="number">0x63066CD9</span>, <span class="number">0xFED41B77</span>, <span class="number">0x3E6E77DB</span>, <span class="number">0xA4D1C46C</span>, <span class="number">0x646BA8C0</span>, <span class="number">0x4ADFA541</span>, <span class="number">0x8A65C9ED</span>,</span><br><span class="line">        <span class="number">0x10DA7A5A</span>, <span class="number">0xD06016F6</span>, <span class="number">0xF00F9345</span>, <span class="number">0x30B5FFE9</span>, <span class="number">0xAA0A4C5E</span>, <span class="number">0x6AB020F2</span>, <span class="number">0x44042D73</span>, <span class="number">0x84BE41DF</span>,</span><br><span class="line">        <span class="number">0x1E01F268</span>, <span class="number">0xDEBB9EC4</span>, <span class="number">0x4369E96A</span>, <span class="number">0x83D385C6</span>, <span class="number">0x196C3671</span>, <span class="number">0xD9D65ADD</span>, <span class="number">0xF762575C</span>, <span class="number">0x37D83BF0</span>,</span><br><span class="line">        <span class="number">0xAD678847</span>, <span class="number">0x6DDDE4EB</span>, <span class="number">0x76DC4190</span>, <span class="number">0xB6662D3C</span>, <span class="number">0x2CD99E8B</span>, <span class="number">0xEC63F227</span>, <span class="number">0xC2D7FFA6</span>, <span class="number">0x026D930A</span>,</span><br><span class="line">        <span class="number">0x98D220BD</span>, <span class="number">0x58684C11</span>, <span class="number">0xC5BA3BBF</span>, <span class="number">0x05005713</span>, <span class="number">0x9FBFE4A4</span>, <span class="number">0x5F058808</span>, <span class="number">0x71B18589</span>, <span class="number">0xB10BE925</span>,</span><br><span class="line">        <span class="number">0x2BB45A92</span>, <span class="number">0xEB0E363E</span>, <span class="number">0xCB61B38D</span>, <span class="number">0x0BDBDF21</span>, <span class="number">0x91646C96</span>, <span class="number">0x51DE003A</span>, <span class="number">0x7F6A0DBB</span>, <span class="number">0xBFD06117</span>,</span><br><span class="line">        <span class="number">0x256FD2A0</span>, <span class="number">0xE5D5BE0C</span>, <span class="number">0x7807C9A2</span>, <span class="number">0xB8BDA50E</span>, <span class="number">0x220216B9</span>, <span class="number">0xE2B87A15</span>, <span class="number">0xCC0C7794</span>, <span class="number">0x0CB61B38</span>,</span><br><span class="line">        <span class="number">0x9609A88F</span>, <span class="number">0x56B3C423</span>, <span class="number">0xD6D6A3E9</span>, <span class="number">0x166CCF45</span>, <span class="number">0x8CD37CF2</span>, <span class="number">0x4C69105E</span>, <span class="number">0x62DD1DDF</span>, <span class="number">0xA2677173</span>,</span><br><span class="line">        <span class="number">0x38D8C2C4</span>, <span class="number">0xF862AE68</span>, <span class="number">0x65B0D9C6</span>, <span class="number">0xA50AB56A</span>, <span class="number">0x3FB506DD</span>, <span class="number">0xFF0F6A71</span>, <span class="number">0xD1BB67F0</span>, <span class="number">0x11010B5C</span>,</span><br><span class="line">        <span class="number">0x8BBEB8EB</span>, <span class="number">0x4B04D447</span>, <span class="number">0x6B6B51F4</span>, <span class="number">0xABD13D58</span>, <span class="number">0x316E8EEF</span>, <span class="number">0xF1D4E243</span>, <span class="number">0xDF60EFC2</span>, <span class="number">0x1FDA836E</span>,</span><br><span class="line">        <span class="number">0x856530D9</span>, <span class="number">0x45DF5C75</span>, <span class="number">0xD80D2BDB</span>, <span class="number">0x18B74777</span>, <span class="number">0x8208F4C0</span>, <span class="number">0x42B2986C</span>, <span class="number">0x6C0695ED</span>, <span class="number">0xACBCF941</span>,</span><br><span class="line">        <span class="number">0x36034AF6</span>, <span class="number">0xF6B9265A</span>, <span class="number">0xCCCCCCCC</span>, <span class="number">0xCCCCCC00</span>, <span class="number">0x00000100</span>, <span class="number">0x00000000</span>, <span class="number">0xF6B9265A</span>, <span class="number">0xCCCCCCCC</span>,</span><br><span class="line">        <span class="number">0x00000008</span>, <span class="number">0x00000000</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">uint32_t</span> enc1[]&#123;</span><br><span class="line">        <span class="number">0x46A95BAD</span>,</span><br><span class="line">        <span class="number">0x1CAC84B6</span>,</span><br><span class="line">        <span class="number">0xA67CB2B2</span>,</span><br><span class="line">        <span class="number">0x32188937</span>,</span><br><span class="line">        <span class="number">0x4872D39F</span>,</span><br><span class="line">        <span class="number">0xF2A2E59B</span>,</span><br><span class="line">        <span class="number">0x011B94D2</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 爆破前7字节</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">7</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> c = <span class="number">28</span>; c &lt; <span class="number">132</span>; c++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> ((~box1[(<span class="type">uint8_t</span>)c ^ <span class="number">0x79</span>] ^ <span class="number">0xB0E0E879</span>) == enc1[i])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, c);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 后16字节进行IDEA解密</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> enc2[<span class="number">16</span>] = &#123;</span><br><span class="line">        <span class="number">0x5C</span>, <span class="number">0x2F</span>, <span class="number">0xD0</span>, <span class="number">0xEC</span>, <span class="number">0x82</span>, <span class="number">0x0E</span>, <span class="number">0x67</span>, <span class="number">0x57</span>,</span><br><span class="line">        <span class="number">0x6A</span>, <span class="number">0x9F</span>, <span class="number">0x91</span>, <span class="number">0xF6</span>, <span class="number">0x95</span>, <span class="number">0xA4</span>, <span class="number">0xAC</span>, <span class="number">0x90</span>&#125;;</span><br><span class="line">    <span class="comment">// unsigned int key[4] = &#123;</span></span><br><span class="line">    <span class="comment">//     0x42B2986C, 0x12345678, 0x0D6D6A3E, 0x89ABCDEF&#125;;</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> key[<span class="number">4</span>] = &#123;</span><br><span class="line">        <span class="number">0x6C98B242</span>, <span class="number">0x78563412</span>, <span class="number">0x3E6A6D0D</span>, <span class="number">0xEFCDAB89</span>&#125;;</span><br><span class="line"></span><br><span class="line">    code keys_input[<span class="number">8</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        keys_input[<span class="number">2</span> * i + <span class="number">1</span>] = key[i] &amp; <span class="number">0xFFFF</span>;</span><br><span class="line">        keys_input[<span class="number">2</span> * i] = (key[i] &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFFFF</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> result[<span class="number">16</span>];</span><br><span class="line">    bitset&lt;64&gt; cipher1, cipher2;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            cipher1[<span class="number">63</span> - (i * <span class="number">8</span> + j)] = (enc2[i] &gt;&gt; (<span class="number">7</span> - j)) &amp; <span class="number">1</span>;</span><br><span class="line">            cipher2[<span class="number">63</span> - (i * <span class="number">8</span> + j)] = (enc2[i + <span class="number">8</span>] &gt;&gt; (<span class="number">7</span> - j)) &amp; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">subkeys_get</span>(keys_input);</span><br><span class="line">    <span class="built_in">inv_subkeys_get</span>(sub_key);</span><br><span class="line"></span><br><span class="line">    bitset&lt;64&gt; plain1 = <span class="built_in">dencrypt</span>(cipher1);</span><br><span class="line">    bitset&lt;64&gt; plain2 = <span class="built_in">dencrypt</span>(cipher2);</span><br><span class="line"></span><br><span class="line">    <span class="type">uint64_t</span> plain1_val = plain<span class="number">1.</span><span class="built_in">to_ullong</span>();</span><br><span class="line">    <span class="type">uint64_t</span> plain2_val = plain<span class="number">2.</span><span class="built_in">to_ullong</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">uint8_t</span> dec2[<span class="number">16</span>]&#123;&#125;;</span><br><span class="line">    <span class="built_in">memcpy</span>(dec2, &amp;plain2_val, <span class="number">8</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>(dec2 + <span class="number">8</span>, &amp;plain1_val, <span class="number">8</span>);</span><br><span class="line">    <span class="built_in">reverse</span>(dec2, dec2 + <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.16s\n&quot;</span>, dec2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>flag{moshui_build_this_block}</p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTF%E6%AF%94%E8%B5%9B/">CTF比赛</a></div><div class="post-share"><div class="social-share" data-image="/img/butterfly-icon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/03/31/2025Tencent/" title="2025腾讯游戏安全技术竞赛 PC客户端安全 初赛WP"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">2025腾讯游戏安全技术竞赛 PC客户端安全 初赛WP</div></div><div class="info-2"><div class="info-item-1">2025腾讯游戏安全技术竞赛 PC客户端安全...</div></div></div></a><a class="pagination-related" href="/2025/04/13/TGCTF2025/" title="TGCTF 2025 逆向WP"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">TGCTF 2025 逆向WP</div></div><div class="info-2"><div class="info-item-1">TGCTF 2025 逆向WP战队名：不知道 排名：3 上次XYCTF是痛失Web手，这次又是痛失Pwn手，啥时候能全队一起打一次（）。这次Re难度还行，磨磨唧唧整了一会也是AK了。 Base64Base64 变种加密 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134_BYTE *__fastcall sub_7FF7DC6C10E0(__int64 a1)&#123;  __int64 v2; // rbx  __int64 v3; // rbp...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/03/31/2025Tencent/" title="2025腾讯游戏安全技术竞赛 PC客户端安全 初赛WP"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-31</div><div class="info-item-2">2025腾讯游戏安全技术竞赛 PC客户端安全 初赛WP</div></div><div class="info-2"><div class="info-item-1">2025腾讯游戏安全技术竞赛 PC客户端安全...</div></div></div></a><a class="pagination-related" href="/2025/04/27/ACTF-Deeptx/" title="ACTF2025 Reverse Deeptx WP"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-27</div><div class="info-item-2">ACTF2025 Reverse Deeptx WP</div></div><div class="info-2"><div class="info-item-1">ACTF2025 Reverse Deeptx...</div></div></div></a><a class="pagination-related" href="/2025/06/01/D3CTF-Reverse/" title="D3CTF Reverse WP"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-01</div><div class="info-item-2">D3CTF Reverse WP</div></div><div class="info-2"><div class="info-item-1">前言这次比赛做了d3kernel和locked door这两题，也是都拿下了一血。这两题都是强对抗类型，和传统的加解密类型题目有区别。kernel是内核逆向&amp;反调试对抗；第二题是vmp对抗+real world类型，模仿的场景是商业软件许可证伪造逆向。这两题都挺有意思的，质量也都很高。 locked door分析查壳查壳发现是vmp 3.5.1+的壳，  绕过反调试由于vmp...</div></div></div></a><a class="pagination-related" href="/2025/07/21/DownUnderCTF2025/" title="DownUnderCTF2025 WP"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-21</div><div class="info-item-2">DownUnderCTF2025 WP</div></div><div class="info-2"><div class="info-item-1">DownUnderCTF Reverse WP这次比赛没有安卓，打的很开心（，给最后一题hard难度的swift逆向折磨到凌晨三点多才AK，总体难度还行，python那题比较有新意，Swift纯是语言本身拔高的难度。 rockymain函数将输入文本进行md5，然后与s1比对，若比对成功则解密文本输出。  直接网站碰撞md5，得到”emergencycall911”  运行输入即可得到Flag。  DUCTF{In_the_land_of_cubicles_lined_in_gray_Where_the_clock_ticks_loud_by_the_light_of_day} skippystone函数和decryptor函数存在无效指针读取操作。   nop对应的两处汇编即可。   运行，自解密得到Flag。  DUCTF{There_echoes_a_chorus_enending_and_wild_Laughter_and_gossip_unruly_and_piled} godot直接拖入Godot RE...</div></div></div></a><a class="pagination-related" href="/2025/05/25/ISCC-Enigma/" title="ISCC擂台赛逆向题 Enigma 题解"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-25</div><div class="info-item-2">ISCC擂台赛逆向题 Enigma 题解</div></div><div class="info-2"><div class="info-item-1">前言这题当时赛中很早就写出爆破解密脚本了，但是一直没爆出来，赛后和出题人咨询发现是密文错了，并且发现其实是程序本身出错了，xor 0x10的代码并没有给实际密文数据段进行xor，而是给一个空数据段xor了，所以导致密文没有xor 0x10，所以是错的密文，也就无法爆破。这题本身题目难度还行，WASM逆向+AES魔改+Siphash+排列爆破。 分析程序流程分析下载得到bin文件，xor...</div></div></div></a><a class="pagination-related" href="/2025/10/22/QWBS9-Secured-Personal-Vault/" title="强网杯S9 Secured Personal Vault WP"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-22</div><div class="info-item-2">强网杯S9 Secured Personal Vault WP</div></div><div class="info-2"><div class="info-item-1">Secured Personal Vault题目考点取证、进程&amp;驱动逆向、msfs.sys逆向、Mailslot结构逆向 0x1 取证阶段下载题目附件，得到MEMORY.DMP，是Windows的系统转储文件格式，使用Windbg打开该文件。 点击!analyze -v，进行dmp分析。  可以发现系统是触发了蓝屏，并且能看到蓝屏时保存的栈信息，是由aPersonalVault+0x2a4b开始调用，然后到最后personalVaultKernel+0x10f5代码触发蓝屏。  跳转到触发蓝屏的汇编代码，可以看到是xor清零了eax，然后后续又访问了[rax]，导致空指针异常。  可以看到起始Call是在aPersonalVault.exe进程中，而触发蓝屏异常的是personalVaultKernel.sys，所以接下来就是Dump转储这两个文件进行分析。  使用!process 0 0命令遍历当前所有进程，发现当前运行的是存在两个aPersonalVault.exe进程。 123456789PROCESS ffffef063fbe8080    SessionId:...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Liv</div><div class="author-info-description">欢迎来到Liv的博客。</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/TKazer"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/TKazer" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#XYCTF2025-%E9%80%86%E5%90%91WP"><span class="toc-number">1.</span> <span class="toc-text">XYCTF2025 逆向WP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#WARMUP"><span class="toc-number">1.1.</span> <span class="toc-text">WARMUP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ezVM"><span class="toc-number">1.2.</span> <span class="toc-text">ezVM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Moon"><span class="toc-number">1.3.</span> <span class="toc-text">Moon</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dragon%EF%BC%885m10v3%E5%B8%88%E5%82%85%E8%A7%A3%E9%A2%98%EF%BC%89"><span class="toc-number">1.4.</span> <span class="toc-text">Dragon（5m10v3师傅解题）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summer%EF%BC%885m10v3%E5%B8%88%E5%82%85%E8%A7%A3%E9%A2%98%EF%BC%89"><span class="toc-number">1.5.</span> <span class="toc-text">Summer（5m10v3师傅解题）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lake"><span class="toc-number">1.6.</span> <span class="toc-text">Lake</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EzObf"><span class="toc-number">1.7.</span> <span class="toc-text">EzObf</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CrackMe"><span class="toc-number">1.8.</span> <span class="toc-text">CrackMe</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/22/QWBS9-Secured-Personal-Vault/" title="强网杯S9 Secured Personal Vault WP">强网杯S9 Secured Personal Vault WP</a><time datetime="2025-10-22T10:21:16.000Z" title="发表于 2025-10-22 18:21:16">2025-10-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/20/WMCTF2025-DevNote/" title="WMCTF2025 VideoPlayer 逆向出题笔记">WMCTF2025 VideoPlayer 逆向出题笔记</a><time datetime="2025-09-20T08:11:34.000Z" title="发表于 2025-09-20 16:11:34">2025-09-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/20/KCTF2025/" title="KCTF2025">KCTF2025</a><time datetime="2025-08-20T08:20:46.000Z" title="发表于 2025-08-20 16:20:46">2025-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/19/SekaiCTF2025/" title="SekaiCTF 2025 Reverse WP">SekaiCTF 2025 Reverse WP</a><time datetime="2025-08-19T13:45:38.000Z" title="发表于 2025-08-19 21:45:38">2025-08-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/31/NepCTF2025-XSafe/" title="NepCTF2025 XSafe WP">NepCTF2025 XSafe WP</a><time datetime="2025-07-31T12:28:40.000Z" title="发表于 2025-07-31 20:28:40">2025-07-31</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://i.postimg.cc/Y2VMBKkT/windows-11-landscape-scenery-sunrise-stock-day-light-3840x2400-5667.jpg);"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By Liv</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>